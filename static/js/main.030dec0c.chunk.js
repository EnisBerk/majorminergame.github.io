(this.webpackJsonpmajor_miner=this.webpackJsonpmajor_miner||[]).push([[0],{228:function(e,t,a){e.exports=a(402)},233:function(e,t,a){},402:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(29),c=a.n(o),i=a(13),s=a(14),l=a(16),u=a(15),d=a(170),m=(a(233),a(405)),h=a(406),p=a(407),f=a(409),g=a(48),y=a.n(g),b=(a(234),a(235),a(237),g.initializeApp({apiKey:"AIzaSyDD9v_OHP17-bC2ZyuHVo1zsH2LkgnIAVo",authDomain:"majorminer-dd13a.firebaseapp.com",databaseURL:"https://majorminer-dd13a.firebaseio.com",projectId:"majorminer-dd13a",storageBucket:"majorminer-dd13a.appspot.com",messagingSenderId:"526186255270"})),E=a(35),v=a(1),w=a(404),k=a(5),x=a.n(k),j=a(17),O=a(408),C=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleClickOpen=function(){n._isMounted&&n.setState({open:!0})},n.handleClose=function(){n._isMounted&&n.setState({open:!1})},n.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("submitButton").click()},n.handleSubmit=function(){var e=Object(j.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,b.auth().signInWithEmailAndPassword(document.getElementById("email").value,document.getElementById("password").value);case 4:a=e.sent,console.log(a),a&&(n.handleClose(),n.props.history.push("/main/clip")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),alert(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),n._isMounted=!1,n.state={open:!1},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){return r.a.createElement(v.q,{item:!0},r.a.createElement(v.b,{color:"default",variant:"outlined",onClick:this.handleClickOpen},"Login"),r.a.createElement(v.j,{open:this.state.open,onClose:this.handleClose,maxWidth:"xs",fullWidth:!0},r.a.createElement(v.m,null,"Login"),r.a.createElement(v.l,null,r.a.createElement(v.q,{container:!0,direction:"column",spacing:16},r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Email"),r.a.createElement(v.u,{id:"email",onKeyPress:this.handleKeyPress}))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Password"),r.a.createElement(v.u,{id:"password",type:"password",onKeyPress:this.handleKeyPress}))))),r.a.createElement(v.k,null,r.a.createElement(v.b,{id:"submitButton",onClick:this.handleSubmit},"Submit"))))}}]),a}(n.Component),T=Object(O.a)(C),S=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"privacy-container"},r.a.createElement("h1",{className:"page-title"},"Privacy and Participation"),r.a.createElement("p",null,"You are being asked to participate in this research study because you are an adult at least 18 years of age. The purpose of this research study is to collect descriptions of sounds from people, so that we can train computer models to automatically describe new sounds. If you agree to participate, we will ask you to listen to sounds and provide free-form textual descriptions of them. Listening to and labeling each sound will take less than a minute, and you can do as many or as few as you would like, whenever you would like. Research-related risks to you are minimal, but include fatigue and exposure to volume variations between sounds. We will only record your descriptions, we will not record any personally identifiable information from you and will only identify you within our system by a username of your choosing. The descriptions that we collect will be stored on our servers at Brooklyn College and made available to other researchers for the same purpose. Your participation in this research is voluntary. If you have any questions, you can contact Michael Mandel at"," ",r.a.createElement("a",{target:"_blank",href:"mailto:mim@sci.brooklyn.cuny.edu",rel:"noopener noreferrer"},"mim@sci.brooklyn.cuny.edu"),"\xa0or 718.951.5000 x2053. If you have any questions about your rights as a research participant or if you would like to talk to someone other than the researchers, you can contact CUNY Research Compliance Administrator at 646-664-8918 or"," ",r.a.createElement("a",{target:"_blank",href:"mailto:HRPP@cuny.edu",rel:"noopener noreferrer"},"HRPP@cuny.edu"),"."))}}]),a}(n.Component),I=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleClickOpenForm=function(){n.setState({openForm:!0})},n.handleCloseForm=function(){n.setState({openForm:!1,agreePolicy:!1})},n.handleAgreePolicy=function(e){n.setState({agreePolicy:e.target.checked}),e.target.checked&&n.setState({policyError:!1})},n.handleClickOpenPolicy=function(){n.setState({openPolicy:!0})},n.handleClosePolicy=function(){n.setState({openPolicy:!1})},n.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("submitButton").click()},n.validateForm=function(){var e=document.getElementById("username").value,t=document.getElementById("email").value,a=document.getElementById("password").value,r=document.getElementById("password2").value;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?n.setState({emailError:!1}):n.setState({emailError:!0}),a.length<6?n.setState({passwordError:!0}):n.setState({passwordError:!1}),a!==r?n.setState({password2Error:!0}):n.setState({password2Error:!1}),""===e?n.setState({usernameError:!0}):n.setState({usernameError:!1}),n.state.agreePolicy||n.setState({policyError:!0}),{email:t,password:a,username:e}},n.handleSubmit=function(){var e=Object(j.a)(x.a.mark((function e(t){var a,r,o,c,i,s,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.history,t.preventDefault(),e.next=4,n.validateForm();case 4:if(r=e.sent,o=r.email,c=r.password,i=r.username,s=b.firestore(),n.state.policyError||n.state.emailError||n.state.passwordError||n.state.password2Error||n.state.usernameError){e.next=21;break}return e.prev=10,e.next=13,b.auth().createUserWithEmailAndPassword(o,c);case 13:l=e.sent,console.log(l),l&&(s.collection("users").doc(b.auth().currentUser.uid).set({username:i,score:0}),n.handleCloseForm(),a.push("/main/clip")),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),alert(e.t0);case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}(),n.state={openForm:!1,agreePolicy:!1,openPolicy:!1,policyError:!1,emailError:!1,passwordError:!1,password2Error:!1,usernameError:!1},n}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(v.q,{item:!0},r.a.createElement(v.b,{color:"default",variant:"outlined",onClick:this.handleClickOpenForm},"Register"),r.a.createElement(v.j,{open:this.state.openForm,onClose:this.handleCloseForm,maxWidth:"xs",fullWidth:!0},r.a.createElement(v.m,null,"Register"),r.a.createElement(v.l,null,r.a.createElement(v.q,{container:!0,direction:"column",justify:"space-evenly",alignItems:"stretch"},r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Username"),r.a.createElement(v.u,{id:"username",type:"text",onKeyPress:this.handleKeyPress})),this.state.usernameError?r.a.createElement(v.p,{error:!0},"Must Enter Your Username."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Email"),r.a.createElement(v.u,{id:"email",type:"email",onKeyPress:this.handleKeyPress})),this.state.emailError?r.a.createElement(v.p,{error:!0},"Invalid email."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Password"),r.a.createElement(v.u,{id:"password",type:"password",onKeyPress:this.handleKeyPress})),this.state.passwordError?r.a.createElement(v.p,{error:!0},"Password should be more than 6 characters."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Reenter password"),r.a.createElement(v.u,{id:"password2",type:"password",onKeyPress:this.handleKeyPress})),this.state.password2Error?r.a.createElement(v.p,{error:!0},"Passwords didn't match."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.o,{control:r.a.createElement(v.g,{checked:this.state.agreePolicy,onChange:this.handleAgreePolicy}),label:r.a.createElement("p",null,"I accept the\xa0",r.a.createElement(v.x,{component:"button",onClick:this.handleClickOpenPolicy,style:{fontSize:"1em"}},"Privacy Policy"))}),this.state.policyError?r.a.createElement(v.p,{error:!0},"You have to accept the privacy policy."):"",r.a.createElement(v.j,{open:this.state.openPolicy,onClose:this.handleClosePolicy,maxWidth:!1},r.a.createElement(v.l,{className:"privacy-in-dialog"},r.a.createElement(S,null)))))),r.a.createElement(v.k,null,r.a.createElement(v.b,{id:"submitButton",onClick:this.handleSubmit},"Submit"))))}}]),a}(n.Component),A=Object(O.a)(I),q=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={clipHistory:{},scoredClipHistory:{}},n}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(v.q,{container:!0,className:"home-container",direction:"column",alignItems:"center"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",{style:{fontSize:"2.5em"}},"Major Miner"),r.a.createElement("p",{style:{fontSize:"1.25em"}},"A Sound Labeling Game")),r.a.createElement(v.q,{item:!0,lg:6,md:8,sm:10},r.a.createElement("p",null,"The goal of the game, besides just listening to interesting soundscapes, is to label them with ",r.a.createElement("b",null,"original"),", yet ",r.a.createElement("b",null,"relevant")," words and phrases that other players ",r.a.createElement("b",null,"agree with"),". We're going to use your descriptions to teach our computers to recognize these same sounds in over 100,000 hours of recordings so that we can better understand the behavior of animals and how it is affected by human activity.")),this.props.authenticated?r.a.createElement(v.q,{item:!0,sm:8,md:8,lg:8,container:!0,justify:"center",spacing:16},r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main"},"Summary")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main/clip"},"Play game!"))):r.a.createElement(v.q,{item:!0,sm:8,md:8,lg:8,container:!0,justify:"center",spacing:16},r.a.createElement(T,null),r.a.createElement(A,null)))}}]),a}(n.Component),P=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(v.q,{container:!0,className:"footer",justify:"center",spacing:8},r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/"},"Home")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/info/faq"},"FAQ")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/info/contact"},"Contact us")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/info/privacy"},"Privacy policy")))}}]),a}(n.Component),M=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(v.q,{"data-testid":"fagPage",container:!0,direction:"column"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",{className:"page-title",style:{paddingTop:"1em"}},"Frequently asked questions")),r.a.createElement(v.q,{item:!0,container:!0,className:"faq-container",direction:"column",spacing:16,alignItems:"stretch"},r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"How should I describe clips?"),r.a.createElement("p",null,"There are many ways you could describe a clip, we want you to make up your own, but if you're stuck, here are some examples. You could use the names of the things you hear (as specifically or generally as you like), general descriptions of the scene, the time of day or year you think it is, even how it makes you feel. Here are some examples, by no means exhaustive, of each of those categories:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Animals \u2013 bird, songbird, sparrow, white-crowned sparrow, gambel's white crowned sparrow"),r.a.createElement("li",null,"Human-generated sounds \u2013 airplane, helicopter, drilling, engine, rumbling"),r.a.createElement("li",null,"Weather \u2013 wind, rain, thunder, gale, drizzle, dripping, stream, river"),r.a.createElement("li",null,"Scenes \u2013 quiet night, dawn chorus"),r.a.createElement("li",null,"Time \u2013 summer, winter, june, august afternoon, night, dawn"),r.a.createElement("li",null,"Feelings \u2013 calm, busy, soothing, loud, cacophonous"))))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"Can I input more than one tag at a time?"),r.a.createElement("p",null,"Yes, separate your tags with commas.")))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"What's a good strategy to use?"),r.a.createElement("p",null,"If you want to earn some points quickly, you can try to guess the obvious labels for a clip. Someone else has probably already used them, so you might get 1 point or you might get 0 points, depending on how many people have used them already. If you're feeling more patient, you can tag a clip with a slightly less obvious, more creative, or more subjective label, so you'll have a better chance of being the first person to use that tag. You won't get any points initially, but when someone else comes along and uses it too, you'll get 2 points. You'd be surprised how frequently other people are thinking the same thing as you. Just remember that every time one user scores a single point, another user has just scored two.")))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"Does it matter how I capitalize, punctuate, or spell words?"),r.a.createElement("p",null,"Not much. Our matching algorithm is clever enough to handle these and give you credit for matching other players' tags that differ in capitalization, punctuation, and spelling")))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"I found a clip that won't play"),r.a.createElement("p",null,'If you press the play button and it jumps right back to "play" mode without playing anything, you\'ve probably found a broken clip. If you could tag it "won\'t play", we\'ll remove it from the game as quickly as we can.')))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"I tried using my browser's back button to go back to my last clip, but it seems to be acting funny"),r.a.createElement("p",null,"That's intentional. Once you've gone to the summary page, you can go back and listen to your last clip (which you can do that from the summary page anyway), but you can't tag it any more. Any tags you try to submit will be ignored. Only go to the summary page once you're finished tagging your current clip. This is to prevent people from looking at the artist name or other metadata when they're tagging a clip."))))))}}]),a}(n.Component),R=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"contact-container"},r.a.createElement("h1",{className:"page-title"},"Contact us"),r.a.createElement("p",null,"Please contact us with any questions, comments, congratulations, or concerns."),r.a.createElement("p",null,"The easiest way is to leave a comment on our blog,"),r.a.createElement("a",{href:"http://blog.majorminer.org"},"blog.majorminer.org"),r.a.createElement("p",null,"but email is also welcome:"),r.a.createElement("a",{target:"_blank",href:"mailto:info@majorminer.org",rel:"noopener noreferrer"},"info@majorminer.org"))}}]),a}(n.Component),N=a(163),U=a.n(N),D=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleToggle=function(){n.setState((function(e){return{open:!e.open}}))},n.handleClose=function(e){n.setState({open:!1})},n.state={open:!1},n}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.state.open;return r.a.createElement("div",null,r.a.createElement(v.t,{buttonRef:function(t){e.anchorEl=t},"aria-owns":t?"account-menu":void 0,"aria-haspopup":"true",onClick:this.handleToggle,color:"inherit"},r.a.createElement(U.a,null)),r.a.createElement(v.B,{open:t,anchorEl:this.anchorEl,placement:"bottom-end",transition:!0,disablePortal:!0},(function(t){var a=t.TransitionProps;return r.a.createElement(v.r,a,r.a.createElement(v.A,null,r.a.createElement(v.i,{onClickAway:e.handleClose},r.a.createElement(v.z,null,r.a.createElement(v.y,{onClick:e.handleClose},r.a.createElement(w.a,{to:"/main"},"Summary")),r.a.createElement(v.y,{onClick:e.handleClose},"Change password"),r.a.createElement(v.y,{onClick:function(){e.props.logout(),e.handleClose()}},"Logout")))))})))}}]),a}(n.Component),F=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).logout=function(){n.userDocListener&&n.userDocListener(),b.auth().signOut().then((function(){n.props.toggleAuth(!1)})).catch((function(e){console.log(e)})),n.props.history.push("/"),n.setState({score:0})},n.state={open:!1,score:null},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.db=b.firestore(),this.user=b.auth().currentUser,this.user&&this.db.collection("users").doc(this.user.uid).get().then((function(t){e.setState({score:t.data().score})}))}},{key:"componentWillUnmount",value:function(){this.userDocListener&&this.userDocListener()}},{key:"render",value:function(){return r.a.createElement(v.a,{position:"sticky"},r.a.createElement(v.J,null,r.a.createElement("div",{className:"nav-container"},r.a.createElement(v.c,{component:w.a,to:"/",className:"nav-item"},r.a.createElement("b",{style:{fontSize:"1.5em"}},"Major Miner")),this.props.authenticated?r.a.createElement(v.c,{component:w.a,to:"/main/clip",className:"nav-item"},"Game"):"",this.props.authenticated?r.a.createElement(v.c,{component:w.a,to:"/info/leaders",className:"nav-item"},"Leaders"):"",this.props.authenticated?r.a.createElement(v.c,{component:w.a,to:"/search",className:"nav-item"},"Search"):"",this.props.authenticated?r.a.createElement("div",{className:"account-button"},r.a.createElement("h4",{style:{margin:"0 0.5em",padding:"0 0.5em"}},"Score: ",this.state.score),r.a.createElement(D,{logout:this.logout})):r.a.createElement("div",{className:"account-button"},r.a.createElement(T,null)))))}}]),a}(n.Component),H=Object(O.a)(F),B=a(76),z=a(78),L=a(24),W=a(166),_=a.n(W),K=a(165),G=a.n(K),Y=a(164),V=a.n(Y),J=a(167),Z=a.n(J),$=a(72),Q=a(55),X=a.n(Q),ee=a(54),te=a.n(ee),ae=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).canvas=r.a.createRef(),n}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(){this.draw()}},{key:"draw",value:function(){var e=this.props.audioData,t=this.canvas.current,a=t.height,n=t.width,r=t.getContext("2d"),o=0,c=1*n/e.length;r.lineWidth=1,r.strokeStyle="#000000",r.clearRect(0,0,n,a),r.beginPath(),r.moveTo(0,a/2);var i,s=Object(L.a)(e);try{for(s.s();!(i=s.n()).done;){var l=i.value/255*a;r.lineTo(o,l),o+=c}}catch(u){s.e(u)}finally{s.f()}r.lineTo(o,a/2),r.stroke()}},{key:"render",value:function(){return r.a.createElement("canvas",{width:"300",height:"300",ref:this.canvas,className:"audio-canvas"})}}]),a}(n.Component),ne=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).setupAudioContext=function(){n.audioContext=new(window.AudioContext||window.webkitAudioContext),n.gainNode=n.audioContext.createGain(),n.gainNode.gain.value=15,n.gainNode.connect(n.audioContext.destination),n.audioSource=n.audioContext.createMediaElementSource(n.audio),n.audioSource.connect(n.gainNode),n.analyser=n.audioContext.createAnalyser(),n.gainNode.connect(n.analyser),n.dataArray=new Uint8Array(n.analyser.frequencyBinCount),n.rafId=requestAnimationFrame(n.tick),n.audio.onended=function(){n._isMounted&&n.setState({play:!1})}},n.toggleAudio=function(){if(0===n.firstPlay)try{n.setupAudioContext(),console.log("props!",n.props.clipId);var e=Date.now();n.db.collection("Randomize").doc(n.props.clipId).set({count:y.a.firestore.FieldValue.increment(1),updated:y.a.firestore.FieldValue.serverTimestamp(),millis:e,userId:y.a.firestore.FieldValue.arrayUnion(n.currentId)},{merge:!0})}catch(t){console.log(t)}n.state.play?n.audio.pause():n.playAuto(n.audio),n._isMounted&&n.setState({play:!n.state.play}),n.firstPlay++},n._isMounted=!1,n.state={audioData:new Uint8Array(0),play:!1,url:""},n.tick=n.tick.bind(Object($.a)(n)),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.user=b.auth().currentUser,this.db=b.firestore(),this.currentId=b.auth().currentUser.uid,this.firstPlay=0,this.audio=new Audio(this.props.url),this.audio.crossOrigin="anonymous",window.screen.height>420&&window.screen.width>380&&this.toggleAudio()}},{key:"tick",value:function(){this.analyser.getByteTimeDomainData(this.dataArray),this._isMounted&&this.setState({audioData:this.dataArray}),this.rafId=requestAnimationFrame(this.tick)}},{key:"playAuto",value:function(e){this.audioContext.resume().then((function(){e.play()}))}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.rafId),this.analyser.disconnect(),this.gainNode.disconnect(),this.audioSource.disconnect(),this._isMounted=!1}},{key:"render",value:function(){return r.a.createElement(v.q,{item:!0,sm:6,md:6,lg:6,className:"canvas-container"},r.a.createElement(v.t,{className:"play-button",onClick:this.toggleAudio,disableRipple:!0,disableTouchRipple:!0},this.state.play?r.a.createElement(te.a,{style:{fontSize:"180px"}}):r.a.createElement(X.a,{style:{fontSize:"180px"}})),this.state.play?r.a.createElement(ae,{audioData:this.state.audioData}):r.a.createElement("canvas",{width:"300",height:"300",className:"audio-canvas"}))}}]),a}(n.Component),re=a(27),oe=a.n(re),ce=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).toggleExample=function(){n.setState({showExample:!n.state.showExample})},n.handleClickOpen=function(){n.setState({open:!0})},n.handleClose=function(){n.setState({open:!1,showExample:!1})},n.state={open:!1,showExample:!1},n}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(v.b,{onClick:this.handleClickOpen},"Rules"),r.a.createElement(v.j,{open:this.state.open,onClose:this.handleClose},r.a.createElement(v.m,null,"Game Rules"),r.a.createElement(v.l,null,r.a.createElement("ul",{className:"rule-list"},r.a.createElement("li",null,"You will be presented with one randomly selected 10-second sound clip at a time."),r.a.createElement("li",null,'Describe that clip with a word or phrase (we call them "tags", here are some\xa0',r.a.createElement(v.c,{onClick:this.toggleExample,style:{fontSize:"0.9em",textDecoration:"underline"}},"examples"),") and ",r.a.createElement("b",null,"press enter"),"."),this.state.showExample?r.a.createElement("div",{className:"example-tags-list"},r.a.createElement("ul",null,r.a.createElement("li",null,"Animals \u2013 bird, songbird, sparrow, white-crowned sparrow, gambel's white crowned sparrow"),r.a.createElement("li",null,"Human-generated sounds \u2013 airplane, helicopter, drilling, engine, rumbling"),r.a.createElement("li",null,"Weather \u2013 wind, rain, thunder, gale, drizzle, dripping, stream, river"),r.a.createElement("li",null,"Scenes \u2013 quiet night, dawn chorus"),r.a.createElement("li",null,"Time \u2013 summer, winter, june, august afternoon, night, dawn"),r.a.createElement("li",null,"Feelings \u2013 calm, busy, soothing, loud, cacophonous"))):"",r.a.createElement("li",null,"If you're the first person to describe that clip with that tag, you'll get ",r.a.createElement("b",null,"2 points")," when the next person tags that clip with that tag."),r.a.createElement("li",null,"If you're the second person to describe that clip with that tag, you'll get ",r.a.createElement("i",null,"1 point")," immediately."),r.a.createElement("li",null,"If more than two people have already tagged that clip with that tag, you ",r.a.createElement("span",{className:"pink"},"won't get any points"),", but you can try another tag."),r.a.createElement("li",null,'Tag each clip as many times as you want, follow one of the "next clip" links to listen to a new one.'))),r.a.createElement("p",{style:{margin:"0em 2em 2em"}},'You can come back to see the rules by clicking "rules" at the top-left corner.')))}}]),a}(n.Component),ie={currentTags:{},displayTag:{},loading:!0,clipHistory:{},scoredClipHistory:{}},se=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).componentDidMount=Object(j.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.user=b.auth().currentUser,n.db=b.firestore(),n.currentId=b.auth().currentUser.uid,n.userId=n.user.uid,n.userRef=n.db.collection("users").doc(n.currentId),n.AudioRef=n.db.collection("audios"),n.firstUserId="",n.loadUrl();case 8:case"end":return e.stop()}}),e)}))),n.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("submitButton").click()},n.loadFiles=Object(j.a)(x.a.mark((function e(){var t,a,r,o,c,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new XMLHttpRequest,c=n.db.collection("audios"),i=n.db.collection("Randomize"),a.onreadystatechange=Object(j.a)(x.a.mark((function e(){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200===a.status&&4===a.readyState)for(t=a.responseText,r=JSON.parse(t),o=r.items,n=0;n<o.length;n++)c.doc(n+"").set({Title:o[n].name,Url:"https://firebasestorage.googleapis.com/v0/b/majorminer-dd13a.appspot.com/o/"+o[n].name+"?alt=media&token="+o[n].metadata.firebaseStorageDownloadTokens}),i.doc(n+"").set({count:0});case 1:case"end":return e.stop()}}),e)}))),a.open("GET","/text/data.json",!0),a.send();case 6:case"end":return e.stop()}}),e)}))),n.loadUrl=Object(j.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.existingTags={},e.next=3,n.randomizeId();case 3:return n.clipId=e.sent,n.audioRef=n.db.collection("audios").doc(n.clipId),e.prev=5,e.next=8,n.audioRef.get();case 8:n.doc=e.sent,n.url=n.doc.data().Url,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),console.log(e.t0);case 15:n.setState({loading:!1});case 16:case"end":return e.stop()}}),e,null,[[5,12]])}))),n.loadExistingTag=function(e){try{e&&e.forEach((function(e){return n.existingTags[e.id]={count:e.data().count}}))}catch(t){console.log("loadExistingTagError: "+t)}return n.existingTags},n.compareTime=function(){var e=Object(j.a)(x.a.mark((function e(t){var a,n,r,o,c,i,s,l,u;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=[])[0]="January",a[1]="February",a[2]="March",a[3]="April",a[4]="May",a[5]="June",a[6]="July",a[7]="August",a[8]="September",a[9]="October",a[10]="November",a[11]="December",n=t.toMillis(),r=new Date,o=r.getDate()+"",c=a[r.getMonth()]+" ",i=r.getFullYear()+"",s=c+o+", "+i,l=Date.parse(s),u=Date.now(),!(u-n<=36e5)){e.next=26;break}return e.abrupt("return",1);case 26:if(!(n<=l+864e5)){e.next=30;break}return e.abrupt("return",2);case 30:if(!(n<=l+6048e5)){e.next=34;break}return e.abrupt("return",3);case 34:return e.abrupt("return",4);case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.oneDayRange=function(){var e=[];e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December";var t=new Date,a=t.getDate()+"",n=e[t.getMonth()]+" "+a+", "+(t.getFullYear()+"");return Date.parse(n)+864e5},n.randomizeId=Object(j.a)(x.a.mark((function e(){var t,a,r,o,c,i,s,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Set,r=Math.random(),e.next=4,n.db.collection("Randomize").where("userId","array-contains",n.currentId).get();case 4:o=e.sent,c=Object(L.a)(o.docs);try{for(c.s();!(i=c.n()).done;)s=i.value,a.add(s.id)}catch(u){c.e(u)}finally{c.f()}return l=n.findMin(.0066*o.size,.33),t=r<l?n.pick_pioneer():n.pick_settler(a),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)}))),n.pick_pioneer=Object(j.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.db.collection("Randomize").where("count","==",0).get();case 2:if(0===(t=e.sent).size){e.next=5;break}return e.abrupt("return",t.docs[0].id+"");case 5:return e.abrupt("return",Math.floor(5*Math.random())+"");case 6:case"end":return e.stop()}}),e)}))),n.pick_settler=function(){var e=Object(j.a)(x.a.mark((function e(t){var a,r,o,c,i,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),r=a-36e5,e.next=4,n.db.collection("Randomize").where("millis","<",r).orderBy("millis").get();case 4:if(0!==(o=e.sent).size){e.next=9;break}return e.abrupt("return",n.pick_pioneer());case 9:c=Object(L.a)(o.docs),e.prev=10,c.s();case 12:if((i=c.n()).done){e.next=18;break}if(s=i.value,t.has(s.id)){e.next=16;break}return e.abrupt("return",s.id+"");case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(10),c.e(e.t0);case 23:return e.prev=23,c.f(),e.finish(23);case 26:return e.abrupt("return",n.pick_pioneer());case 27:case"end":return e.stop()}}),e,null,[[10,20,23,26]])})));return function(t){return e.apply(this,arguments)}}(),n.findMin=function(e,t){return e>t?t:e},n.getNextClip=Object(j.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({currentTags:{},loading:!0,displayTag:{}}),n.loadUrl();case 2:case"end":return e.stop()}}),e)}))),n.handleSubmit=Object(j.a)(x.a.mark((function e(){var t,a,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("tags").value.toLowerCase().replace(/\s/g,"").split(","),a={},n.audioTagRef=n.audioRef.collection("tags"),n.audioUsersRef=n.audioRef.collection("users"),e.next=6,n.audioTagRef.get();case 6:return r=e.sent,e.next=9,n.loadExistingTag(r);case 9:n.existingTags=e.sent,t.forEach((function(e){Object.keys(n.existingTags).includes(e)?a[e]={count:n.existingTags[e].count,score:0}:a[e]={count:0,score:0}})),document.getElementById("tags").value="",n.loadTagsToDb(a).then((function(e){n.setState({currentTags:e});for(var t=function(){var t=r[a];n.setState((function(a){return{displayTag:Object(z.a)(Object(z.a)({},a.displayTag),{},Object(B.a)({},t,{score:e[t].score,count:e[t].count}))}}))},a=0,r=Object.keys(e);a<r.length;a++)t()}));case 13:case"end":return e.stop()}}),e)}))),n.getUserId=function(){var e=Object(j.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.db.collection("audios").doc(n.clipId).collection("users").where("tags","array-contains",t).get();case 2:return a=e.sent,e.abrupt("return",a.docs[0].id);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.loadTagsToDb=function(){var e=Object(j.a)(x.a.mark((function e(t){var a,r,o,c,i,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,a=0,r=Object.keys(t);case 2:if(!(a<r.length)){e.next=21;break}return o=r[a],e.next=6,n.addUser(o);case 6:if(c={Title:n.doc.data().Title,Url:n.doc.data().Url},1!==t[o].count){e.next=15;break}return e.next=10,n.getUserId(o);case 10:i=e.sent,s=n.db.collection("users").doc(i),i!==n.currentId&&(n.History(s,i,2,c,o),t[o].score=1,n.History(n.userRef,n.currentId,1,c,o)),e.next=16;break;case 15:t[o].count,n.History(n.userRef,n.currentId,0,c,o);case 16:return e.next=18,n.audioUsersRef.doc(n.currentId).set({tags:oe.a.firestore.FieldValue.arrayUnion(o)},{merge:!0});case 18:a++,e.next=2;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.log("can't upload tags into DB!!:  "+e.t0);case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t){return e.apply(this,arguments)}}(),n.addUser=function(e){try{n.audioTagRef.doc(e).set({count:oe.a.firestore.FieldValue.increment(1),userId:oe.a.firestore.FieldValue.arrayUnion(n.currentId)},{merge:!0})}catch(t){console.log("can't add user: "+t)}},n.refreshTotalScore=function(e,t){e.update({score:oe.a.firestore.FieldValue.increment(t)})},n.isFrist=function(e){n.audioTagRef.doc(e).set({count:1,userId:oe.a.firestore.FieldValue.arrayUnion(n.currentId)})},n.History=function(){var e=Object(j.a)(x.a.mark((function e(t,a,r,o,c){var i,s,l,u,d,m;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{(i=t.collection("clipHistory")).doc(n.clipId).get().then((function(e){e.exists?n.updateHistory(i,r,c):n.createHistory(i,r,o.Title,o.Url,c),n.refreshTotalScore(t,r)}))}catch(h){console.log("Can't create clipHistory!! "+h)}if(0===r){e.next=17;break}return s=n.oneDayRange(),e.prev=3,l=n.db.collection("scoreRecord").doc(a),(u=n.db.collection("scoreRecord").doc(a).collection("score")).doc(s+"").get().then((function(e){e.exists?u.doc(s+"").update({score:oe.a.firestore.FieldValue.increment(r)}):u.doc(s+"").set({score:r,millis:s,createdAt:oe.a.firestore.FieldValue.serverTimestamp()})})),e.next=9,n.db.collection("users").doc(a).get();case 9:d=e.sent,m=d.data().username,l.set({updated:oe.a.firestore.FieldValue.serverTimestamp(),millis:s,username:m}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),console.log("Can't add score scoreRecord!");case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t,a,n,r,o){return e.apply(this,arguments)}}(),n.updateHistory=function(e,t,a){try{e.doc(n.clipId).update({MyTag:oe.a.firestore.FieldValue.arrayUnion(a),score:oe.a.firestore.FieldValue.increment(t),lastUpdatedAt:oe.a.firestore.FieldValue.serverTimestamp()})}catch(r){console.log("Can't update clipHistory: "+r)}},n.createHistory=function(e,t,a,r,o){var c=[o];try{e.doc(n.clipId).set({MyTag:c,Title:a,Url:r,score:t,createdAt:oe.a.firestore.FieldValue.serverTimestamp(),lastUpdatedAt:oe.a.firestore.FieldValue.serverTimestamp()})}catch(i){console.log("Can't create clipHistory: "+i)}},n.state=Object(z.a)({},ie),n.textInput=r.a.createRef(),n}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(e,t){this.textInput.current.focus()}},{key:"render",value:function(){var e=this.url,t=this.clipId,a=this.state.displayTag;return r.a.createElement(v.q,{container:!0,className:"game-container",direction:"column",alignItems:"center",spacing:16},r.a.createElement(v.q,{item:!0,container:!0,alignItems:"center"},r.a.createElement(v.q,{item:!0,sm:1,md:1,lg:1},r.a.createElement(ce,null)),r.a.createElement(v.q,{item:!0,sm:10,md:10,lg:10},r.a.createElement("h1",null,"Describe this clip")),r.a.createElement(v.q,{item:!0,sm:1,md:1,lg:1})),r.a.createElement(v.q,{item:!0,container:!0,alignItems:"center"},r.a.createElement(v.q,{item:!0,sm:3,md:3,lg:3},r.a.createElement(w.a,{to:"/main",style:{textDecoration:"none"}},r.a.createElement(v.t,{id:"gameSummary",style:{borderRadius:"0"}},r.a.createElement(V.a,null),"Summary"))),this.state.loading?r.a.createElement(v.q,{item:!0,sm:6,md:6,lg:6,className:"canvas-container"},r.a.createElement(v.h,{size:100,thickness:3.6})):r.a.createElement(ne,{url:e,clipId:t}),r.a.createElement(v.q,{item:!0,sm:3,md:3,lg:3},r.a.createElement(v.t,{id:"nextClip",style:{borderRadius:"0"},onClick:this.getNextClip},"Next Clip",r.a.createElement(G.a,null)))),r.a.createElement(v.q,{item:!0,id:"listTag",sm:10,md:6,lg:8},Object.keys(a).map((function(e,t){return 0===a[e].count?r.a.createElement("span",{key:t,className:"gray"},e,"\xa0"):1===a[e].score?r.a.createElement("i",{key:t,className:"1-point"},e,"\xa0"):r.a.createElement("span",{key:t,className:"pink"},e,"\xa0")}))),r.a.createElement(v.q,{item:!0,sm:10,md:6,lg:8},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Input your tags..."),r.a.createElement(v.u,{id:"tags",type:"text",autoFocus:!0,inputRef:this.textInput,onKeyPress:this.handleKeyPress,endAdornment:r.a.createElement(v.v,{position:"end"},r.a.createElement(v.t,{id:"submitButton",onClick:this.handleSubmit},r.a.createElement(_.a,null)),r.a.createElement(v.K,{title:r.a.createElement("p",null,"You can input more than one tag ",r.a.createElement("br",null),"by using commas to separate."),placement:"right"},r.a.createElement(v.s,null,r.a.createElement(Z.a,null))))}),r.a.createElement(v.p,null,"Tag colors: ",r.a.createElement("i",null,"1 point"),", ",r.a.createElement("span",{className:"gray"},"no points yet (but could be 2)"),", ",r.a.createElement("span",{className:"pink"},"0 points"),"."))))}}]),a}(n.Component),le=a(56),ue=a(169),de=a.n(ue),me=a(168),he=a.n(me),pe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).setupAudioContext=function(){try{n.audioContext=new(window.AudioContext||window.webkitAudioContext),n.gainNode=n.audioContext.createGain(),n.gainNode.gain.value=15,n.gainNode.connect(n.audioContext.destination)}catch(e){console.log(e)}n.audio=new Audio(n.props.url),n.audioSource=n.audioContext.createMediaElementSource(n.audio),n.audio.crossOrigin="anonymous",n.audioSource.connect(n.gainNode),n.audioContext.resume().then((function(){console.log("Playback resumed successfully")})),n.audio.onended=function(){n.setState({play:!1}),n.props.togglePlay(!1)}},n.toggleAudio=function(){if(!1===n.state.play)try{n.setupAudioContext()}catch(e){console.log(e)}n.state.play?n.audio.pause():n.audio.play(),n.setState({play:!n.state.play}),n.props.togglePlay(!n.state.play)},n.toggleSeeOtherTags=function(){n.setState({seeOthers:!n.state.seeOthers})},n.SummaryAudioCard=function(){return r.a.createElement(v.d,{className:"audio-card"},r.a.createElement(v.f,null,r.a.createElement("h5",null,n.props.clip),r.a.createElement("p",null,"Your tags: ",n.props.TAG||"loading"),n.state.seeOthers?r.a.createElement("p",null,"Other's tags: ",n.props.other||"None"," "):""),r.a.createElement(v.e,{style:{paddingTop:"0"}},r.a.createElement(v.t,{onClick:n.toggleAudio},n.state.play?r.a.createElement(te.a,null):r.a.createElement(X.a,null)),r.a.createElement(v.t,{onClick:n.toggleSeeOtherTags},n.state.seeOthers?r.a.createElement(he.a,null):r.a.createElement(de.a,null))))},n.SearchResultAudioCard=function(){return r.a.createElement(v.d,{className:"audio-card"},r.a.createElement(v.f,null,r.a.createElement("h5",null,n.props.clip)),r.a.createElement(v.e,{style:{paddingTop:"0"}},r.a.createElement(v.t,{onClick:n.toggleAudio},n.state.play?r.a.createElement(te.a,null):r.a.createElement(X.a,null))),r.a.createElement("h5",null,n.props.tag,": ",n.props.count," times"))},n.state={play:!1,seeOthers:!1},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.setupAudioContext()}},{key:"componentWillUnmount",value:function(){this.gainNode.disconnect(),this.audioSource.disconnect()}},{key:"render",value:function(){return r.a.createElement("div",null,this.props.fromSummary?this.SummaryAudioCard():this.SearchResultAudioCard())}}]),a}(n.Component),fe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).togglePlay=function(e){n.setState({play:e})},n.state={clipHistory:{},scoredClipHistory:{},play:!1},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.user=b.auth().currentUser,this.db=b.firestore(),this.audioRef=this.db.collection("audios"),this.userId=this.user.uid,this.userRef=this.db.collection("users").doc(this.userId),console.log("Your are "+this.userId),e.next=8,this.GetSummary();case 8:t=e.sent,this.CallCloudFunctionForOtherTags(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"CallCloudFunctionForOtherTags",value:function(){var e=Object(j.a)(x.a.mark((function e(t){var a,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=b.functions().httpsCallable("getOtherTags_v1"),e.next=4,a({clipHistory:t[0],scoredClipHistory:t[1]});case 4:n=e.sent,this.setState({clipHistory:n.data[0],scoredClipHistory:n.data[1]}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Unable to getting other tags from database");case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"gatherData",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t,a,n,r,o,c,i,s,l,u,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("users").get();case 2:t=e.sent,a=Object(L.a)(t.docs),e.prev=4,a.s();case 6:if((n=a.n()).done){e.next=38;break}return r=n.value,e.next=10,this.db.collection("users").doc(r.id).collection("clipHistory").get();case 10:o=e.sent,c={},i=Object(L.a)(o.docs),e.prev=13,i.s();case 15:if((s=i.n()).done){e.next=28;break}return l=s.value,e.next=19,this.db.collection("audios").doc(l.id).get();case 19:return u=e.sent,e.next=22,this.db.collection("audios").doc(l.id).collection("users").doc(r.id).get();case 22:d=e.sent,c={ID:l.id,Title:u.data().Title,Url:u.data().Url,myTag:d.data().tags},console.log(c),this.db.collection("users").doc(r.id).collection("clipHistory").doc(l.id).update({Title:u.data().Title,Url:u.data().Url,MyTag:d.data().tags});case 26:e.next=15;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(13),i.e(e.t0);case 33:return e.prev=33,i.f(),e.finish(33);case 36:e.next=6;break;case 38:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(4),a.e(e.t1);case 43:return e.prev=43,a.f(),e.finish(43);case 46:case"end":return e.stop()}}),e,this,[[4,40,43,46],[13,30,33,36]])})));return function(){return e.apply(this,arguments)}}()},{key:"GetSummary",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t,a,n,r,o,c,i,s,l,u;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,this.userRef.collection("clipHistory").orderBy("lastUpdatedAt","desc").limit(10).get();case 3:a=e.sent,n=Object(L.a)(a.docs);try{for(n.s();!(r=n.n()).done;)o=r.value,t[o.id]={},t[o.id].title=o.data().Title,t[o.id].url=o.data().Url,t[o.id].MyTag=o.data().MyTag,t[o.id].TAG=o.data().MyTag.join(", "),t[o.id].other=[]}catch(d){n.e(d)}finally{n.f()}return c={},e.next=9,this.userRef.collection("clipHistory").where("score",">",0).orderBy("score","desc").limit(10).get();case 9:i=e.sent,s=Object(L.a)(i.docs);try{for(s.s();!(l=s.n()).done;)u=l.value,c[u.id]={},c[u.id].title=u.data().Title,c[u.id].url=u.data().Url,c[u.id].MyTag=u.data().MyTag,c[u.id].TAG=u.data().MyTag.join(", ")}catch(d){s.e(d)}finally{s.f()}return this.setState({clipHistory:t,scoredClipHistory:c}),e.abrupt("return",[t,c]);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSummaryFromCloudFunctions",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.functions().httpsCallable("getSummary_CallFromClient_v1"),e.next=3,t({uid:this.userId});case 3:a=e.sent,this.setState({clipHistory:a.data[0],scoredClipHistory:a.data[1]});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSummary1",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t,a,n,r,o,c,i,s,l,u,d,m,h,p,f,g,y,b,E,v,w,k,j,O,C,T;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userRef.collection("clipHistory").orderBy("lastUpdatedAt").limit(10).get();case 2:t=e.sent,a={},n=[],r=[],c=Object(L.a)(t.docs);try{for(c.s();!(i=c.n()).done;)s=i.value,a[s.id]={},l=this.audioRef.doc(s.id),n.push(l.collection("users").doc(this.userId).get()),r.push(l.get()),o=l.collection("tags").get()}catch(x){c.e(x)}finally{c.f()}return e.next=10,Promise.all([r,n,o]);case 10:return u=e.sent,d=Object(le.a)(u,3),m=d[0],h=d[1],d[2],m.forEach((function(e){e.then((function(e){a[e.id].title=e.data().Title,a[e.id].url=e.data().Url,a[e.id].id=e.id}))})),h.forEach((function(e){e.then((function(e){var t=e.ref.parent.parent.id;a[t].TAG=e.data().tags.join(", ")}))})),this.setState({clipHistory:a}),e.next=20,this.userRef.collection("clipHistory").where("score",">",0).orderBy("score").limit(10).get();case 20:p=e.sent,f={},g=[],y=[],E=Object(L.a)(p.docs);try{for(E.s();!(v=E.n()).done;)w=v.value,f[w.id]={score:w.data().score},k=this.audioRef.doc(w.id),g.push(k.collection("users").doc(this.userId).get()),y.push(k.get()),b=k.collection("tags").get()}catch(x){E.e(x)}finally{E.f()}return e.next=28,Promise.all([y,g,b]);case 28:j=e.sent,O=Object(le.a)(j,3),C=O[0],T=O[1],O[2],C.forEach((function(e){e.then((function(e){f[e.id].title=e.data().Title,f[e.id].url=e.data().Url,f[e.id].id=e.id}))})),T.forEach((function(e){e.then((function(e){var t=e.ref.parent.parent.id;f[t].TAG=e.data().tags.join(", ")}))})),this.setState({scoredClipHistory:f});case 36:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSummary",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t,a,n,r,o,c,i,s,l,u,d,m,h,p,f,g,y,b,E,v,w,k,j,O,C,T,S,I,A,q,P,M,R,N;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=[],e.next=4,this.userRef.collection("clipHistory").orderBy("lastUpdatedAt").limit(10).get();case 4:n=e.sent,r={},o=Object(L.a)(n.docs),e.prev=7,o.s();case 9:if((c=o.n()).done){e.next=34;break}return i=c.value,r[i.id]={},s=this.audioRef.doc(i.id).get(),t=[],a=[],l=this.audioRef.doc(i.id).collection("users").doc(this.userId).get(),u=this.audioRef.doc(i.id).collection("tags").get(),e.next=19,Promise.all([s,l,u]);case 19:d=e.sent,m=Object(le.a)(d,3),h=m[0],p=m[1],f=m[2],r[i.id].title=h.data().Title,r[i.id].url=h.data().Url,r[i.id].id=i.id,t=p.data().tags,r[i.id].TAG=t.join(", "),g=Object(L.a)(f.docs);try{for(g.s();!(y=g.n()).done;)b=y.value,t.includes(b.id)||a.push(b.id)}catch(x){g.e(x)}finally{g.f()}r[i.id].other=a.join(", ");case 32:e.next=9;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(7),o.e(e.t0);case 39:return e.prev=39,o.f(),e.finish(39);case 42:return this.setState({clipHistory:r}),e.next=45,this.userRef.collection("clipHistory").where("score",">",0).orderBy("score").limit(10).get();case 45:E=e.sent,v={},w=Object(L.a)(E.docs),e.prev=48,w.s();case 50:if((k=w.n()).done){e.next=75;break}return j=k.value,v[j.id]={},O=this.audioRef.doc(j.id).get(),C=this.audioRef.doc(j.id).collection("users").doc(this.userId).get(),T=this.audioRef.doc(j.id).collection("tags").get(),e.next=58,Promise.all([O,C,T]);case 58:S=e.sent,I=Object(le.a)(S,3),A=I[0],q=I[1],P=I[2],v[j.id].title=A.data().Title,v[j.id].url=A.data().Url,v[j.id].id=j.id,t=[],a=[],t=q.data().tags,v[j.id].TAG=t.join(", "),M=Object(L.a)(P.docs);try{for(M.s();!(R=M.n()).done;)N=R.value,t.includes(N.id)||a.push(N.id)}catch(x){M.e(x)}finally{M.f()}v[j.id].other=a.join(", ");case 73:e.next=50;break;case 75:e.next=80;break;case 77:e.prev=77,e.t1=e.catch(48),w.e(e.t1);case 80:return e.prev=80,w.f(),e.finish(80);case 83:this.setState({scoredClipHistory:v});case 84:case"end":return e.stop()}}),e,this,[[7,36,39,42],[48,77,80,83]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.clipHistory,n=t.scoredClipHistory;return r.a.createElement(v.q,{container:!0,className:"summary-container",direction:"column",alignItems:"center"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",null,"Summary Page")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main/clip"},"Play game!")),r.a.createElement("h2",null,"Your last 10 clips"),r.a.createElement(v.q,{item:!0,className:"card-list-container"},r.a.createElement(v.q,{container:!0,className:"card-list",spacing:8},Object.keys(a).map((function(t,n){return r.a.createElement(v.q,{item:!0,key:t},r.a.createElement(pe,{url:a[t].url,clip:a[t].title,clipId:a[t].id,TAG:a[t].TAG,togglePlay:e.togglePlay,other:a[t].other,fromSummary:!0}))})))),r.a.createElement("h2",null,"Your last scored clips"),r.a.createElement(v.q,{item:!0,className:"card-list-container"},r.a.createElement(v.q,{container:!0,className:"card-list",spacing:8},Object.keys(n).map((function(t,a){return r.a.createElement(v.q,{item:!0,key:a},r.a.createElement(pe,{url:n[t].url,clip:n[t].title,TAG:n[t].TAG,clipId:n[t].id,other:n[t].other,togglePlay:e.togglePlay,fromSummary:!0}))})))))}}]),a}(n.Component),ge=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).month=function(){var e=[];return e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December",e},n.handleChange=function(e,t){n.setState({value:t})},n.oneDayRange=function(){var e=n.month(),t=new Date,a=t.getDate()+"",r=e[t.getMonth()]+" "+a+", "+(t.getFullYear()+"");return Date.parse(r)+864e5},n.firstOfWeekRange=function(){var e=n.month(),t=new Date,a=t.getDay(),r=t.getDate()+"",o=e[t.getMonth()]+" "+r+", "+(t.getFullYear()+"");return Date.parse(o)-36e5*(a-1)*24},n.getTotal=Object(j.a)(x.a.mark((function e(){var t,a,r,o,c,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,n.db.collection("users").where("score",">",0).get();case 3:a=e.sent,r=Object(L.a)(a.docs);try{for(r.s();!(o=r.n()).done;)c=o.value,i={username:c.data().username,score:c.data().score,userId:c.id},t.push(i)}catch(s){r.e(s)}finally{r.f()}return t.sort((function(e,t){return t.score-e.score})),t.splice(10,t.length),e.next=10,n.setState({totalLeader:t});case 10:case"end":return e.stop()}}),e)}))),n.getToday=Object(j.a)(x.a.mark((function e(){var t,a,r,o,c,i,s,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=n.oneDayRange(),e.next=4,n.db.collection("scoreRecord").where("millis","==",a).get();case 4:r=e.sent,o=Object(L.a)(r.docs),e.prev=6,o.s();case 8:if((c=o.n()).done){e.next=17;break}return i=c.value,e.next=12,n.db.collection("scoreRecord").doc(i.id).collection("score").where("millis","==",a).get();case 12:s=e.sent,l={username:i.data().username,score:s.docs[0].data().score,userId:i.id},t.push(l);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return t.sort((function(e,t){return t.score-e.score})),t.splice(10,t.length),e.next=29,n.setState({todayLeader:t});case 29:case"end":return e.stop()}}),e,null,[[6,19,22,25]])}))),n.getWeek=Object(j.a)(x.a.mark((function e(){var t,a,r,o,c,i,s,l,u,d,m,h;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=n.firstOfWeekRange(),e.next=4,n.db.collection("scoreRecord").where("millis",">=",a).get();case 4:r=e.sent,o=Object(L.a)(r.docs),e.prev=6,o.s();case 8:if((c=o.n()).done){e.next=20;break}return i=c.value,s=0,e.next=13,n.db.collection("scoreRecord").doc(i.id).collection("score").where("millis",">=",a).get();case 13:l=e.sent,u=Object(L.a)(l.docs);try{for(u.s();!(d=u.n()).done;)m=d.value,s+=m.data().score}catch(p){u.e(p)}finally{u.f()}h={username:i.data().username,score:s,userId:i.id},t.push(h);case 18:e.next=8;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(6),o.e(e.t0);case 25:return e.prev=25,o.f(),e.finish(25);case 28:return t.sort((function(e,t){return t.score-e.score})),t.splice(10,t.length),e.next=32,n.setState({weekLeader:t});case 32:case"end":return e.stop()}}),e,null,[[6,22,25,28]])}))),n.getTabContent=function(e,t,a){var o;switch(n.state.value){case 0:o=e;break;case 1:o=t;break;case 2:o=a;break;default:o=[]}return r.a.createElement(v.D,{className:"leaderboard"},r.a.createElement(v.G,null,r.a.createElement(v.H,null,r.a.createElement(v.F,{align:"center"},"User"),r.a.createElement(v.F,{align:"center"},"Score"))),r.a.createElement(v.E,null,o.map((function(e,t){return r.a.createElement(v.H,{key:e.userId},r.a.createElement(v.F,{align:"center"},e.username),r.a.createElement(v.F,{align:"center"},e.score))}))))},n.state={value:0,todayLeader:[],weekLeader:[],totalLeader:[]},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.user=b.auth().currentUser,this.db=b.firestore(),this.user&&(this.currentId=b.auth().currentUser.uid),this.getTotal(),this.getToday(),this.getWeek()}},{key:"render",value:function(){var e=this.state,t=e.todayLeader,a=e.weekLeader,n=e.totalLeader;return r.a.createElement("div",null,r.a.createElement("h1",null,"Leaders"),r.a.createElement("div",{className:"table-container"},r.a.createElement(v.a,{position:"static"},r.a.createElement(v.I,{value:this.state.value,onChange:this.handleChange,centered:!0},r.a.createElement(v.C,{label:"Today"}),r.a.createElement(v.C,{label:"This week"}),r.a.createElement(v.C,{label:"Total"}))),this.getTabContent(t,a,n)))}}]),a}(n.Component),ye=a(53),be=a.n(ye),Ee=a(52),ve=a.n(Ee),we=a(71),ke=a.n(we),xe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).getTagList=Object(j.a)(x.a.mark((function e(){var t,a,r,o,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,n.db.collection("tagList").orderBy("count","desc").limit(10).get();case 3:a=e.sent,r=Object(L.a)(a.docs);try{for(r.s();!(o=r.n()).done;)c=o.value,t.push({tag:c.id,count:c.data().count})}catch(i){r.e(i)}finally{r.f()}return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)}))),n.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("searchButton").click()},n.handleSubmit=function(){var e=document.getElementById("searchItem").value;n.handleListClick(null,e)},n.handleListClick=function(){var e=Object(j.a)(x.a.mark((function e(t,a){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.props.history.push({pathname:"/searchresult/"+a});case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),n.getList=function(e){return r.a.createElement(be.a,null,e.map((function(e,t){return r.a.createElement(ve.a,{button:!0,key:e.tag},r.a.createElement(ke.a,{primary:e.tag,onClick:function(t){return n.handleListClick(t,e.tag)}}))})))},n.state={topTags:[]},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=Object(j.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.user=b.auth().currentUser,this.db=b.firestore(),this.currentId=b.auth().currentUser.uid,this.userRef=this.db.collection("users"),e.t0=this,e.next=7,this.getTagList();case 7:e.t1=e.sent,e.t2={topTags:e.t1},e.t0.setState.call(e.t0,e.t2);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.topTags;return r.a.createElement(v.q,{container:!0,className:"search-container",direction:"column",alignItems:"center"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",null,"Search Page")),r.a.createElement(v.q,{item:!0},r.a.createElement("label",null,"Search by tag: "),r.a.createElement("input",{id:"searchItem",type:"text",onKeyPress:this.handleKeyPress}),r.a.createElement(v.b,{id:"searchButton",onClick:this.handleSubmit},"search")),r.a.createElement(v.q,{item:!0,xs:12,md:6},r.a.createElement("div",null,this.getList(e))))}}]),a}(n.Component),je=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).togglePlay=function(e){n.setState({play:e})},n.state={tag:null,MyTag:null,tagOrderArray:[],clipNumber:null,play:!1},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=Object(j.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.user=b.auth().currentUser,this.db=b.firestore(),this.audioRef=this.db.collection("audios"),this.userId=this.user.uid,this.userRef=this.db.collection("users").doc(this.userId),this.getCurrentTarget();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentTarget",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t,a,n,r,o,c=this;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.location.href,a=t.lastIndexOf("/"),n=t.substring(a+1,t.length),e.next=5,this.db.collection("tagList").doc(n).collection("clipIDs").orderBy("count","desc").get();case 5:r=e.sent,o=[],this.MyTagMap={},r.forEach((function(e){o.push({tag:e.id,count:e.data().count}),c.MyTagMap[e.id]={},c.MyTagMap[e.id].url=e.data().Url,c.MyTagMap[e.id].clip=e.data().Title,c.MyTagMap[e.id].count=e.data().count})),this.setState({tag:n,MyTag:this.MyTagMap,tagOrderArray:o,clipNumber:r.size});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.MyTag,n=t.tag,o=t.clipNumber,c=t.tagOrderArray;return r.a.createElement(v.q,{container:!0,className:"summary-container",direction:"column",alignItems:"center"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",null,"Search Result")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/search"},"Search more!")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main/clip"},"Play game!")),r.a.createElement("h2",null,"Here are ",o," clips have been describe as ",n),r.a.createElement(v.q,{item:!0,className:"card-list-container"},r.a.createElement(v.q,{container:!0,className:"card-list",spacing:8},c.map((function(t,o){return r.a.createElement(v.q,{item:!0,key:t.tag},r.a.createElement(pe,{tag:n,clip:a[t.tag].clip,url:a[t.tag].url,count:a[t.tag].count,togglePlay:e.togglePlay,fromSummary:!1}))})))))}}]),a}(n.Component),Oe=Object(E.createMuiTheme)({palette:{primary:{main:"#C6C6CE"},secondary:{main:"#A6A6B2"}},typography:{useNextVariants:!0}});function Ce(e){var t=e.component,a=e.authenticated,n=Object(d.a)(e,["component","authenticated"]);return r.a.createElement(m.a,Object.assign({},n,{render:function(e){return!0===a?r.a.createElement(t,Object.assign({},e,n)):r.a.createElement(h.a,{to:"/"})}}))}var Te=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).toggleAuth=function(e){n.setState({authenticated:e})},n.state={authenticated:!1,user:null,loading:!0},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.listener=b.auth().onAuthStateChanged((function(t){t?e.setState({authenticated:!0,user:t,loading:!1}):e.setState({authenticated:!1,user:null,loading:!1})}))}},{key:"componentWillUnmount",value:function(){this.listener()}},{key:"render",value:function(){var e=this;return this.state.loading?r.a.createElement(E.MuiThemeProvider,{theme:Oe},r.a.createElement("div",{className:"loading-container"},r.a.createElement(v.h,{size:100,thickness:3.6}))):r.a.createElement(E.MuiThemeProvider,{theme:Oe},r.a.createElement(p.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(H,{authenticated:this.state.authenticated,toggleAuth:this.toggleAuth}),r.a.createElement("main",null,r.a.createElement(f.a,null,r.a.createElement(m.a,{exact:!0,path:"/",render:function(t){return r.a.createElement(q,Object.assign({},t,{authenticated:e.state.authenticated}))}}),r.a.createElement(m.a,{path:"/info/faq",component:M}),r.a.createElement(m.a,{path:"/info/contact",component:R}),r.a.createElement(m.a,{path:"/info/privacy",component:S}),r.a.createElement(m.a,{path:"/info/leaders",component:ge}),r.a.createElement(m.a,{path:"/searchresult",component:je}),r.a.createElement(Ce,{exact:!0,path:"/main",component:fe,authenticated:this.state.authenticated}),r.a.createElement(Ce,{exact:!0,path:"/main/clip",component:se,authenticated:this.state.authenticated}),r.a.createElement(Ce,{path:"/search",component:xe,authenticated:this.state.authenticated}))),r.a.createElement(P,null))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[228,1,2]]]);
//# sourceMappingURL=main.030dec0c.chunk.js.map