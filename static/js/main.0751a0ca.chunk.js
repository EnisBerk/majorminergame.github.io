(this.webpackJsonpmajor_miner=this.webpackJsonpmajor_miner||[]).push([[0],{263:function(e,t,a){e.exports=a(482)},268:function(e,t,a){},482:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(25),o=a.n(s),i=a(205),c=(a(268),a(485)),l=a(486),u=a(487),d=a(489),m=a(50),h=a.n(m);var p=h.a.initializeApp({apiKey:"AIzaSyDD9v_OHP17-bC2ZyuHVo1zsH2LkgnIAVo",authDomain:"majorminer-dd13a.firebaseapp.com",databaseURL:"https://majorminer-dd13a.firebaseio.com",projectId:"majorminer-dd13a",storageBucket:"majorminer-dd13a.appspot.com",messagingSenderId:"526186255270"}),g=a(38),y=a(1),E=a(7),f=a.n(E),b=a(51),v=a(20),w=a(14),x=a(484),k=a(488);class C extends n.Component{constructor(e){var t;super(e),t=this,this.handleClickOpen=()=>{this._isMounted&&this.setState({open:!0})},this.handleClose=()=>{this._isMounted&&this.setState({open:!1})},this.handleKeyPress=e=>{"Enter"===e.key&&document.getElementById("submitButton").click()},this.handleSubmit=function(){var e=Object(w.a)(f.a.mark((function e(a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,p.auth().signInWithEmailAndPassword(document.getElementById("email").value,document.getElementById("password").value);case 4:n=e.sent,console.log(n),n&&(t.handleClose(),t.props.history.push("/main/clip")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),alert(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),this._isMounted=!1,this.state={open:!1}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){return r.a.createElement(y.q,{item:!0},r.a.createElement(y.b,{color:"default",variant:"outlined",onClick:this.handleClickOpen},"Login"),r.a.createElement(y.j,{open:this.state.open,onClose:this.handleClose,maxWidth:"xs",fullWidth:!0},r.a.createElement(y.m,null,"Login"),r.a.createElement(y.l,null,r.a.createElement(y.q,{container:!0,direction:"column",spacing:16},r.a.createElement(y.q,{item:!0},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Email"),r.a.createElement(y.u,{id:"email",onKeyPress:this.handleKeyPress}))),r.a.createElement(y.q,{item:!0},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Password"),r.a.createElement(y.u,{id:"password",type:"password",onKeyPress:this.handleKeyPress}))))),r.a.createElement(y.k,null,r.a.createElement(y.b,{id:"submitButton",onClick:this.handleSubmit},"Submit"))))}}var S=Object(k.a)(C);class I extends n.Component{render(){return r.a.createElement("div",{className:"privacy-container"},r.a.createElement("h1",{className:"page-title"},"Privacy and Participation"),r.a.createElement("p",null,"You are being asked to participate in this research study because you are an adult at least 18 years of age. The purpose of this research study is to collect descriptions of sounds from people, so that we can train computer models to automatically describe new sounds. If you agree to participate, we will ask you to listen to sounds and provide free-form textual descriptions of them. Listening to and labeling each sound will take less than a minute, and you can do as many or as few as you would like, whenever you would like. Research-related risks to you are minimal, but include fatigue and exposure to volume variations between sounds. We will only record your descriptions, we will not record any personally identifiable information from you and will only identify you within our system by a username of your choosing. The descriptions that we collect will be stored on our servers at Brooklyn College and made available to other researchers for the same purpose. Your participation in this research is voluntary. If you have any questions, you can contact Michael Mandel at"," ",r.a.createElement("a",{target:"_blank",href:"mailto:mim@sci.brooklyn.cuny.edu",rel:"noopener noreferrer"},"mim@sci.brooklyn.cuny.edu"),"\xa0or 718.951.5000 x2053. If you have any questions about your rights as a research participant or if you would like to talk to someone other than the researchers, you can contact CUNY Research Compliance Administrator at 646-664-8918 or"," ",r.a.createElement("a",{target:"_blank",href:"mailto:HRPP@cuny.edu",rel:"noopener noreferrer"},"HRPP@cuny.edu"),"."))}}var T=I;class j extends n.Component{constructor(e){var t;super(e),t=this,this.handleClickOpenForm=()=>{this.setState({openForm:!0})},this.handleCloseForm=()=>{this.setState({openForm:!1,agreePolicy:!1})},this.handleAgreePolicy=e=>{this.setState({agreePolicy:e.target.checked}),e.target.checked&&this.setState({policyError:!1})},this.handleClickOpenPolicy=()=>{this.setState({openPolicy:!0})},this.handleClosePolicy=()=>{this.setState({openPolicy:!1})},this.handleKeyPress=e=>{"Enter"===e.key&&document.getElementById("submitButton").click()},this.validateForm=()=>{const e=document.getElementById("username").value,t=document.getElementById("email").value,a=document.getElementById("password").value,n=document.getElementById("password2").value;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?this.setState({emailError:!1}):this.setState({emailError:!0}),a.length<6?this.setState({passwordError:!0}):this.setState({passwordError:!1}),a!==n?this.setState({password2Error:!0}):this.setState({password2Error:!1}),""===e?this.setState({usernameError:!0}):this.setState({usernameError:!1}),this.state.agreePolicy||this.setState({policyError:!0}),{email:t,password:a,username:e}},this.handleSubmit=function(){var e=Object(w.a)(f.a.mark((function e(a){var n,r,s,o,i,c,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props.history,a.preventDefault(),e.next=4,t.validateForm();case 4:if(r=e.sent,s=r.email,o=r.password,i=r.username,c=p.firestore(),t.state.policyError||t.state.emailError||t.state.passwordError||t.state.password2Error||t.state.usernameError){e.next=21;break}return e.prev=10,e.next=13,p.auth().createUserWithEmailAndPassword(s,o);case 13:l=e.sent,console.log(l),l&&(c.collection("users").doc(p.auth().currentUser.uid).set({username:i,score:0}),t.handleCloseForm(),n.push("/main/clip")),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),alert(e.t0);case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}(),this.state={openForm:!1,agreePolicy:!1,openPolicy:!1,policyError:!1,emailError:!1,passwordError:!1,password2Error:!1,usernameError:!1}}render(){return r.a.createElement(y.q,{item:!0},r.a.createElement(y.b,{color:"default",variant:"outlined",onClick:this.handleClickOpenForm},"Register"),r.a.createElement(y.j,{open:this.state.openForm,onClose:this.handleCloseForm,maxWidth:"xs",fullWidth:!0},r.a.createElement(y.m,null,"Register"),r.a.createElement(y.l,null,r.a.createElement(y.q,{container:!0,direction:"column",justify:"space-evenly",alignItems:"stretch"},r.a.createElement(y.q,{item:!0},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Username"),r.a.createElement(y.u,{id:"username",type:"text",onKeyPress:this.handleKeyPress})),this.state.usernameError?r.a.createElement(y.p,{error:!0},"Must Enter Your Username."):""),r.a.createElement(y.q,{item:!0},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Email"),r.a.createElement(y.u,{id:"email",type:"email",onKeyPress:this.handleKeyPress})),this.state.emailError?r.a.createElement(y.p,{error:!0},"Invalid email."):""),r.a.createElement(y.q,{item:!0},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Password"),r.a.createElement(y.u,{id:"password",type:"password",onKeyPress:this.handleKeyPress})),this.state.passwordError?r.a.createElement(y.p,{error:!0},"Password should be more than 6 characters."):""),r.a.createElement(y.q,{item:!0},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Reenter password"),r.a.createElement(y.u,{id:"password2",type:"password",onKeyPress:this.handleKeyPress})),this.state.password2Error?r.a.createElement(y.p,{error:!0},"Passwords didn't match."):""),r.a.createElement(y.q,{item:!0},r.a.createElement(y.o,{control:r.a.createElement(y.g,{checked:this.state.agreePolicy,onChange:this.handleAgreePolicy}),label:r.a.createElement("p",null,"I accept the\xa0",r.a.createElement(y.x,{component:"button",onClick:this.handleClickOpenPolicy,style:{fontSize:"1em"}},"Privacy Policy"))}),this.state.policyError?r.a.createElement(y.p,{error:!0},"You have to accept the privacy policy."):"",r.a.createElement(y.j,{open:this.state.openPolicy,onClose:this.handleClosePolicy,maxWidth:!1},r.a.createElement(y.l,{className:"privacy-in-dialog"},r.a.createElement(T,null)))))),r.a.createElement(y.k,null,r.a.createElement(y.b,{id:"submitButton",onClick:this.handleSubmit},"Submit"))))}}var O=Object(k.a)(j);class q extends n.Component{constructor(e){var t;super(e),t=this,this.Summary=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i,c,l,u,d,m,h,g,y,E,w,x,k,C,S,I,T,j,O,q,A,P,N,R,D,M,H,U;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.user=p.auth().currentUser,t.db=p.firestore(),t.currentId=t.user.uid,t.userId=t.user.uid,t.userRef=t.db.collection("users").doc(t.currentId),t.audioRef=t.db.collection("audios"),a=[],n=[],e.next=10,t.userRef.collection("clipHistory").orderBy("lastUpdatedAt").limit(10).get();case 10:r=e.sent,s={},o=Object(v.a)(r.docs),e.prev=13,o.s();case 15:if((i=o.n()).done){e.next=41;break}return c=i.value,s[c.id]={score:c.data().score},l=t.db.collection("audios").doc(c.id).get(),a=[],n=[],u=t.db.collection("audios").doc(c.id).collection("users").doc(t.userId).get(),d=t.db.collection("audios").doc(c.id).collection("tags").get(),e.next=25,Promise.all([l,u,d]);case 25:m=e.sent,h=Object(b.a)(m,3),g=h[0],y=h[1],E=h[2],s[c.id].title=g.data().Title,s[c.id].url=g.data().Url,s[c.id].id=c.id,a=y.data().tags,s[c.id].TAG=a.join(", "),w=Object(v.a)(E.docs);try{for(w.s();!(x=w.n()).done;)k=x.value,a.includes(k.id)||n.push(k.id)}catch(f){w.e(f)}finally{w.f()}s[c.id].other=n.join(", "),t.setState({clipHistory:s});case 39:e.next=15;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(13),o.e(e.t0);case 46:return e.prev=46,o.f(),e.finish(46);case 49:return e.next=51,t.userRef.collection("clipHistory").where("score",">",0).orderBy("score").limit(10).get();case 51:C=e.sent,S={},I=Object(v.a)(C.docs),e.prev=54,I.s();case 56:if((T=I.n()).done){e.next=83;break}return c=T.value,S[c.id]={score:c.data().score},j=t.db.collection("audios").doc(c.id).get(),O=t.db.collection("audios").doc(c.id).collection("tags").where("userId","array-contains",t.userId).get(),q=t.db.collection("audios").doc(c.id).collection("tags").get(),e.next=64,Promise.all([j,O,q]);case 64:A=e.sent,P=Object(b.a)(A,3),g=P[0],N=P[1],R=P[2],S[c.id].title=g.data().Title,S[c.id].url=g.data().Url,S[c.id].id=c.id,a=[],n=[],D=Object(v.a)(N.docs);try{for(D.s();!(M=D.n()).done;)k=M.value,a.push(k.id)}catch(f){D.e(f)}finally{D.f()}S[c.id].TAG=a.join(", "),H=Object(v.a)(R.docs);try{for(H.s();!(U=H.n()).done;)k=U.value,a.includes(k.id)||n.push(k.id)}catch(f){H.e(f)}finally{H.f()}S[c.id].other=n.join(", "),t.setState({scoredClipHistory:S});case 81:e.next=56;break;case 83:e.next=88;break;case 85:e.prev=85,e.t1=e.catch(54),I.e(e.t1);case 88:return e.prev=88,I.f(),e.finish(88);case 91:console.log(t.state.scoredClipHistory),console.log(t.state.clipHistory),t.props.history.push({pathname:"/main",state:{clipHistory:t.state.clipHistory,scoredClipHistory:t.state.scoredClipHistory}});case 94:case"end":return e.stop()}}),e,null,[[13,43,46,49],[54,85,88,91]])}))),this.state={clipHistory:{},scoredClipHistory:{}}}render(){return r.a.createElement(y.q,{container:!0,className:"home-container",direction:"column",alignItems:"center"},r.a.createElement(y.q,{item:!0},r.a.createElement("h1",{style:{fontSize:"2.5em"}},"Major Miner"),r.a.createElement("p",{style:{fontSize:"1.25em"}},"A Sound Labeling Game")),r.a.createElement(y.q,{item:!0,lg:6,md:8,sm:10},r.a.createElement("p",null,"The goal of the game, besides just listening to interesting soundscapes, is to label them with ",r.a.createElement("b",null,"original"),", yet ",r.a.createElement("b",null,"relevant")," words and phrases that other players ",r.a.createElement("b",null,"agree with"),". We're going to use your descriptions to teach our computers to recognize these same sounds in over 100,000 hours of recordings so that we can better understand the behavior of animals and how it is affected by human activity.")),this.props.authenticated?r.a.createElement(y.q,{item:!0,sm:8,md:8,lg:8,container:!0,justify:"center",spacing:16},r.a.createElement(y.q,{item:!0,onClick:this.Summary},"Summary"),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/main/clip"},"Play game!"))):r.a.createElement(y.q,{item:!0,sm:8,md:8,lg:8,container:!0,justify:"center",spacing:16},r.a.createElement(S,null),r.a.createElement(O,null)))}}var A=q;class P extends n.Component{render(){return r.a.createElement(y.q,{container:!0,className:"footer",justify:"center",spacing:8},r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/"},"Home")),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/info/faq"},"FAQ")),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/info/contact"},"Contact us")),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/info/privacy"},"Privacy policy")))}}var N=P;class R extends n.Component{render(){return r.a.createElement(y.q,{"data-testid":"fagPage",container:!0,direction:"column"},r.a.createElement(y.q,{item:!0},r.a.createElement("h1",{className:"page-title",style:{paddingTop:"1em"}},"Frequently asked questions")),r.a.createElement(y.q,{item:!0,container:!0,className:"faq-container",direction:"column",spacing:16,alignItems:"stretch"},r.a.createElement(y.q,{item:!0},r.a.createElement(y.d,null,r.a.createElement(y.f,null,r.a.createElement("h3",null,"How should I describe clips?"),r.a.createElement("p",null,"There are many ways you could describe a clip, we want you to make up your own, but if you're stuck, here are some examples. You could use the names of the things you hear (as specifically or generally as you like), general descriptions of the scene, the time of day or year you think it is, even how it makes you feel. Here are some examples, by no means exhaustive, of each of those categories:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Animals \u2013 bird, songbird, sparrow, white-crowned sparrow, gambel's white crowned sparrow"),r.a.createElement("li",null,"Human-generated sounds \u2013 airplane, helicopter, drilling, engine, rumbling"),r.a.createElement("li",null,"Weather \u2013 wind, rain, thunder, gale, drizzle, dripping, stream, river"),r.a.createElement("li",null,"Scenes \u2013 quiet night, dawn chorus"),r.a.createElement("li",null,"Time \u2013 summer, winter, june, august afternoon, night, dawn"),r.a.createElement("li",null,"Feelings \u2013 calm, busy, soothing, loud, cacophonous"))))),r.a.createElement(y.q,{item:!0},r.a.createElement(y.d,null,r.a.createElement(y.f,null,r.a.createElement("h3",null,"Can I input more than one tag at a time?"),r.a.createElement("p",null,"Yes, separate your tags with commas.")))),r.a.createElement(y.q,{item:!0},r.a.createElement(y.d,null,r.a.createElement(y.f,null,r.a.createElement("h3",null,"What's a good strategy to use?"),r.a.createElement("p",null,"If you want to earn some points quickly, you can try to guess the obvious labels for a clip. Someone else has probably already used them, so you might get 1 point or you might get 0 points, depending on how many people have used them already. If you're feeling more patient, you can tag a clip with a slightly less obvious, more creative, or more subjective label, so you'll have a better chance of being the first person to use that tag. You won't get any points initially, but when someone else comes along and uses it too, you'll get 2 points. You'd be surprised how frequently other people are thinking the same thing as you. Just remember that every time one user scores a single point, another user has just scored two.")))),r.a.createElement(y.q,{item:!0},r.a.createElement(y.d,null,r.a.createElement(y.f,null,r.a.createElement("h3",null,"Does it matter how I capitalize, punctuate, or spell words?"),r.a.createElement("p",null,"Not much. Our matching algorithm is clever enough to handle these and give you credit for matching other players' tags that differ in capitalization, punctuation, and spelling")))),r.a.createElement(y.q,{item:!0},r.a.createElement(y.d,null,r.a.createElement(y.f,null,r.a.createElement("h3",null,"I found a clip that won't play"),r.a.createElement("p",null,'If you press the play button and it jumps right back to "play" mode without playing anything, you\'ve probably found a broken clip. If you could tag it "won\'t play", we\'ll remove it from the game as quickly as we can.')))),r.a.createElement(y.q,{item:!0},r.a.createElement(y.d,null,r.a.createElement(y.f,null,r.a.createElement("h3",null,"I tried using my browser's back button to go back to my last clip, but it seems to be acting funny"),r.a.createElement("p",null,"That's intentional. Once you've gone to the summary page, you can go back and listen to your last clip (which you can do that from the summary page anyway), but you can't tag it any more. Any tags you try to submit will be ignored. Only go to the summary page once you're finished tagging your current clip. This is to prevent people from looking at the artist name or other metadata when they're tagging a clip."))))))}}var D=R;class M extends n.Component{render(){return r.a.createElement("div",{className:"contact-container"},r.a.createElement("h1",{className:"page-title"},"Contact us"),r.a.createElement("p",null,"Please contact us with any questions, comments, congratulations, or concerns."),r.a.createElement("p",null,"The easiest way is to leave a comment on our blog,"),r.a.createElement("a",{href:"http://blog.majorminer.org"},"blog.majorminer.org"),r.a.createElement("p",null,"but email is also welcome:"),r.a.createElement("a",{target:"_blank",href:"mailto:info@majorminer.org",rel:"noopener noreferrer"},"info@majorminer.org"))}}var H=M,U=a(197),F=a.n(U);class B extends n.Component{constructor(e){super(e),this.handleToggle=()=>{this.setState(e=>({open:!e.open}))},this.handleClose=e=>{this.setState({open:!1})},this.state={open:!1}}render(){const e=this.state.open;return r.a.createElement("div",null,r.a.createElement(y.t,{buttonRef:e=>{this.anchorEl=e},"aria-owns":e?"account-menu":void 0,"aria-haspopup":"true",onClick:this.handleToggle,color:"inherit"},r.a.createElement(F.a,null)),r.a.createElement(y.B,{open:e,anchorEl:this.anchorEl,placement:"bottom-end",transition:!0,disablePortal:!0},({TransitionProps:e})=>r.a.createElement(y.r,e,r.a.createElement(y.A,null,r.a.createElement(y.i,{onClickAway:this.handleClose},r.a.createElement(y.z,null,r.a.createElement(y.y,{onClick:this.handleClose},r.a.createElement(x.a,{to:"/main"},"Summary")),r.a.createElement(y.y,{onClick:this.handleClose},"Change password"),r.a.createElement(y.y,{onClick:()=>{this.props.logout(),this.handleClose()}},"Logout")))))))}}var L=B;class z extends n.Component{constructor(e){super(e),this.logout=()=>{this.userDocListener&&this.userDocListener(),p.auth().signOut().then(()=>{this.props.toggleAuth(!1)}).catch(e=>{console.log(e)}),this.props.history.push("/"),this.setState({score:0})},this.state={open:!1,score:null}}componentDidMount(){this.db=p.firestore(),this.user=p.auth().currentUser,this.user&&this.db.collection("users").doc(this.user.uid).get().then(e=>{this.setState({score:e.data().score})})}componentWillUnmount(){this.userDocListener&&this.userDocListener()}render(){return r.a.createElement(y.a,{position:"sticky"},r.a.createElement(y.J,null,r.a.createElement("div",{className:"nav-container"},r.a.createElement(y.c,{component:x.a,to:"/",className:"nav-item"},r.a.createElement("b",{style:{fontSize:"1.5em"}},"Major Miner")),this.props.authenticated?r.a.createElement(y.c,{component:x.a,to:"/main/clip",className:"nav-item"},"Game"):"",this.props.authenticated?r.a.createElement(y.c,{component:x.a,to:"/info/leaders",className:"nav-item"},"Leaders"):"",this.props.authenticated?r.a.createElement(y.c,{component:x.a,to:"/search",className:"nav-item"},"Search"):"",this.props.authenticated?r.a.createElement("div",{className:"account-button"},r.a.createElement("h4",{style:{margin:"0 0.5em",padding:"0 0.5em"}},"Score: ",this.state.score),r.a.createElement(L,{logout:this.logout})):r.a.createElement("div",{className:"account-button"},r.a.createElement(S,null)))))}}var W=Object(k.a)(z),_=a(114),K=a(201),V=a.n(K),Y=a(200),G=a.n(Y),J=a(199),Z=a.n(J),$=a(202),Q=a.n($),X=a(60),ee=a.n(X),te=a(59),ae=a.n(te);class ne extends n.Component{constructor(e){super(e),this.canvas=r.a.createRef()}componentDidUpdate(){this.draw()}draw(){const e=this.props.audioData,t=this.canvas.current,a=t.height,n=t.width,r=t.getContext("2d");let s=0;const o=1*n/e.length;r.lineWidth=1,r.strokeStyle="#000000",r.clearRect(0,0,n,a),r.beginPath(),r.moveTo(0,a/2);var i,c=Object(v.a)(e);try{for(c.s();!(i=c.n()).done;){const e=i.value/255*a;r.lineTo(s,e),s+=o}}catch(l){c.e(l)}finally{c.f()}r.lineTo(s,a/2),r.stroke()}render(){return r.a.createElement("canvas",{width:"300",height:"300",ref:this.canvas,className:"audio-canvas"})}}var re=ne;class se extends n.Component{constructor(e){super(e),this.setupAudioContext=()=>{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=15,this.gainNode.connect(this.audioContext.destination),this.audioSource=this.audioContext.createMediaElementSource(this.audio),this.audioSource.connect(this.gainNode),this.analyser=this.audioContext.createAnalyser(),this.gainNode.connect(this.analyser),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.rafId=requestAnimationFrame(this.tick),this.audio.onended=()=>{this._isMounted&&this.setState({play:!1})}},this.toggleAudio=()=>{if(0===this.firstPlay)try{this.setupAudioContext(),console.log("props!",this.props.clipId);var e=Date.now();this.db.collection("Randomize").doc(this.props.clipId).set({count:h.a.firestore.FieldValue.increment(1),updated:h.a.firestore.FieldValue.serverTimestamp(),millis:e,userId:h.a.firestore.FieldValue.arrayUnion(this.currentId)},{merge:!0})}catch(t){console.log(t)}this.state.play?this.audio.pause():this.playAuto(this.audio),this._isMounted&&this.setState({play:!this.state.play}),this.firstPlay++},this._isMounted=!1,this.state={audioData:new Uint8Array(0),play:!1,url:""},this.tick=this.tick.bind(this)}componentDidMount(){this._isMounted=!0,this.user=p.auth().currentUser,this.db=p.firestore(),this.currentId=p.auth().currentUser.uid,this.firstPlay=0,this.audio=new Audio(this.props.url),this.audio.crossOrigin="anonymous",window.screen.height>420&&window.screen.width>380&&this.toggleAudio()}tick(){this.analyser.getByteTimeDomainData(this.dataArray),this._isMounted&&this.setState({audioData:this.dataArray}),this.rafId=requestAnimationFrame(this.tick)}playAuto(e){this.audioContext.resume().then(()=>{e.play()})}componentWillUnmount(){cancelAnimationFrame(this.rafId),this.analyser.disconnect(),this.gainNode.disconnect(),this.audioSource.disconnect(),this._isMounted=!1}render(){return r.a.createElement(y.q,{item:!0,sm:6,md:6,lg:6,className:"canvas-container"},r.a.createElement(y.t,{className:"play-button",onClick:this.toggleAudio,disableRipple:!0,disableTouchRipple:!0},this.state.play?r.a.createElement(ae.a,{style:{fontSize:"180px"}}):r.a.createElement(ee.a,{style:{fontSize:"180px"}})),this.state.play?r.a.createElement(re,{audioData:this.state.audioData}):r.a.createElement("canvas",{width:"300",height:"300",className:"audio-canvas"}))}}var oe=se,ie=a(23),ce=a.n(ie);class le extends n.Component{constructor(e){super(e),this.toggleExample=()=>{this.setState({showExample:!this.state.showExample})},this.handleClickOpen=()=>{this.setState({open:!0})},this.handleClose=()=>{this.setState({open:!1,showExample:!1})},this.state={open:!1,showExample:!1}}render(){return r.a.createElement("div",null,r.a.createElement(y.b,{onClick:this.handleClickOpen},"Rules"),r.a.createElement(y.j,{open:this.state.open,onClose:this.handleClose},r.a.createElement(y.m,null,"Game Rules"),r.a.createElement(y.l,null,r.a.createElement("ul",{className:"rule-list"},r.a.createElement("li",null,"You will be presented with one randomly selected 10-second sound clip at a time."),r.a.createElement("li",null,'Describe that clip with a word or phrase (we call them "tags", here are some\xa0',r.a.createElement(y.c,{onClick:this.toggleExample,style:{fontSize:"0.9em",textDecoration:"underline"}},"examples"),") and ",r.a.createElement("b",null,"press enter"),"."),this.state.showExample?r.a.createElement("div",{className:"example-tags-list"},r.a.createElement("ul",null,r.a.createElement("li",null,"Animals \u2013 bird, songbird, sparrow, white-crowned sparrow, gambel's white crowned sparrow"),r.a.createElement("li",null,"Human-generated sounds \u2013 airplane, helicopter, drilling, engine, rumbling"),r.a.createElement("li",null,"Weather \u2013 wind, rain, thunder, gale, drizzle, dripping, stream, river"),r.a.createElement("li",null,"Scenes \u2013 quiet night, dawn chorus"),r.a.createElement("li",null,"Time \u2013 summer, winter, june, august afternoon, night, dawn"),r.a.createElement("li",null,"Feelings \u2013 calm, busy, soothing, loud, cacophonous"))):"",r.a.createElement("li",null,"If you're the first person to describe that clip with that tag, you'll get ",r.a.createElement("b",null,"2 points")," when the next person tags that clip with that tag."),r.a.createElement("li",null,"If you're the second person to describe that clip with that tag, you'll get ",r.a.createElement("i",null,"1 point")," immediately."),r.a.createElement("li",null,"If more than two people have already tagged that clip with that tag, you ",r.a.createElement("span",{className:"pink"},"won't get any points"),", but you can try another tag."),r.a.createElement("li",null,'Tag each clip as many times as you want, follow one of the "next clip" links to listen to a new one.'))),r.a.createElement("p",{style:{margin:"0em 2em 2em"}},'You can come back to see the rules by clicking "rules" at the top-left corner.')))}}var ue=le;const de={currentTags:{},displayTag:{},loading:!0,clipHistory:{},scoredClipHistory:{}};class me extends n.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=Object(w.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.user=p.auth().currentUser,t.db=p.firestore(),t.currentId=p.auth().currentUser.uid,t.userId=t.user.uid,t.userRef=t.db.collection("users").doc(t.currentId),t.audioRef=t.db.collection("audios"),t.firstUserId="",t.loadUrl();case 8:case"end":return e.stop()}}),e)}))),this.Summary=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i,c,l,u,d,m,h,p,g,y,E,w,x,k,C,S,I,T,j,O,q,A,P,N,R,D,M,H;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],n=[],e.next=4,t.userRef.collection("clipHistory").orderBy("lastUpdatedAt").limit(10).get();case 4:r=e.sent,s={},o=Object(v.a)(r.docs),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=35;break}return c=i.value,s[c.id]={score:c.data().score},l=t.db.collection("audios").doc(c.id).get(),a=[],n=[],u=t.db.collection("audios").doc(c.id).collection("users").doc(t.userId).get(),d=t.db.collection("audios").doc(c.id).collection("tags").get(),e.next=19,Promise.all([l,u,d]);case 19:m=e.sent,h=Object(b.a)(m,3),p=h[0],g=h[1],y=h[2],s[c.id].title=p.data().Title,s[c.id].url=p.data().Url,s[c.id].id=c.id,a=g.data().tags,s[c.id].TAG=a.join(", "),E=Object(v.a)(y.docs);try{for(E.s();!(w=E.n()).done;)x=w.value,a.includes(x.id)||n.push(x.id)}catch(f){E.e(f)}finally{E.f()}s[c.id].other=n.join(", "),t.setState({clipHistory:s});case 33:e.next=9;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(7),o.e(e.t0);case 40:return e.prev=40,o.f(),e.finish(40);case 43:return e.next=45,t.userRef.collection("clipHistory").where("score",">",0).orderBy("score").limit(10).get();case 45:k=e.sent,C={},S=Object(v.a)(k.docs),e.prev=48,S.s();case 50:if((I=S.n()).done){e.next=77;break}return c=I.value,C[c.id]={score:c.data().score},T=t.db.collection("audios").doc(c.id).get(),j=t.db.collection("audios").doc(c.id).collection("tags").where("userId","array-contains",t.userId).get(),O=t.db.collection("audios").doc(c.id).collection("tags").get(),e.next=58,Promise.all([T,j,O]);case 58:q=e.sent,A=Object(b.a)(q,3),p=A[0],P=A[1],N=A[2],C[c.id].title=p.data().Title,C[c.id].url=p.data().Url,C[c.id].id=c.id,a=[],n=[],R=Object(v.a)(P.docs);try{for(R.s();!(D=R.n()).done;)x=D.value,a.push(x.id)}catch(f){R.e(f)}finally{R.f()}C[c.id].TAG=a.join(", "),M=Object(v.a)(N.docs);try{for(M.s();!(H=M.n()).done;)x=H.value,a.includes(x.id)||n.push(x.id)}catch(f){M.e(f)}finally{M.f()}C[c.id].other=n.join(", "),t.setState({scoredClipHistory:C});case 75:e.next=50;break;case 77:e.next=82;break;case 79:e.prev=79,e.t1=e.catch(48),S.e(e.t1);case 82:return e.prev=82,S.f(),e.finish(82);case 85:t.props.history.push({pathname:"/main",state:{clipHistory:t.state.clipHistory,scoredClipHistory:t.state.scoredClipHistory}});case 86:case"end":return e.stop()}}),e,null,[[7,37,40,43],[48,79,82,85]])}))),this.handleKeyPress=e=>{"Enter"===e.key&&document.getElementById("submitButton").click()},this.loadFiles=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new XMLHttpRequest,o=[],e.next=4,t.db.collection("audios");case 4:return i=e.sent,e.next=7,t.db.collection("Randomize");case 7:c=e.sent,n.onreadystatechange=Object(w.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200===n.status&&4===n.readyState)for(a=n.responseText,console.log(typeof a),r=JSON.parse(a),s=r.items,t=0;t<s.length;t++)i.doc(t+"").set({Title:s[t].name,Url:"https://firebasestorage.googleapis.com/v0/b/majorminer-dd13a.appspot.com/o/"+s[t].name+"?alt=media&token="+s[t].metadata.firebaseStorageDownloadTokens}),c.doc(t+"").set({count:0});case 1:case"end":return e.stop()}}),e)}))),n.open("GET","/text/data.json",!0),n.send(),console.log(o.length);case 12:case"end":return e.stop()}}),e)}))),this.loadUrl=Object(w.a)(f.a.mark((function e(){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("currentUser: "+p.auth().currentUser.uid),t.existingTags={},e.next=4,t.randomizeId();case 4:return t.clipId=e.sent,console.log(t.clipId),e.next=8,t.db.collection("audios").doc(t.clipId);case 8:return t.audioRef=e.sent,e.prev=9,e.next=12,t.audioRef.get();case 12:a=e.sent,t.url=a.data().Url,console.log(t.clipId),console.log(t.url),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),console.log(e.t0);case 21:return e.next=23,t.setState({loading:!1});case 23:case"end":return e.stop()}}),e,null,[[9,18]])}))),this.loadExistingTag=e=>{try{e&&e.forEach(e=>this.existingTags[e.id]={count:e.data().count})}catch(t){console.log("loadExistingTagError: "+t)}return this.existingTags},this.compareTime=function(){var e=Object(w.a)(f.a.mark((function e(t){var a,n,r,s,o,i,c,l,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=[])[0]="January",a[1]="February",a[2]="March",a[3]="April",a[4]="May",a[5]="June",a[6]="July",a[7]="August",a[8]="September",a[9]="October",a[10]="November",a[11]="December",n=t.toMillis(),r=new Date,s=r.getDate()+"",o=a[r.getMonth()]+" ",i=r.getFullYear()+"",c=o+s+", "+i,l=Date.parse(c),u=Date.now(),!(u-n<=36e5)){e.next=26;break}return e.abrupt("return",1);case 26:if(!(n<=l+864e5)){e.next=30;break}return e.abrupt("return",2);case 30:if(!(n<=l+6048e5)){e.next=34;break}return e.abrupt("return",3);case 34:return e.abrupt("return",4);case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.oneDayRange=()=>{var e=[];e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December";var t=new Date,a=t.getDate()+"";const n=e[t.getMonth()]+" "+a+", "+(t.getFullYear()+"");return Date.parse(n)+864e5},this.randomizeId=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i,c,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Set,r=Math.random(),e.next=4,t.db.collection("Randomize").where("userId","array-contains",t.currentId).get();case 4:s=e.sent,o=Object(v.a)(s.docs);try{for(o.s();!(i=o.n()).done;)c=i.value,n.add(c.id)}catch(u){o.e(u)}finally{o.f()}return l=t.findMin(.0066*s.size,.33),console.log("rand",r),console.log("pnew",l),r<l?(a=t.pick_pioneer(),console.log("rand < pnew")):(a=t.pick_settler(n),console.log("rand > pnew")),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)}))),this.pick_pioneer=Object(w.a)(f.a.mark((function e(){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.collection("Randomize").where("count","==",0).get();case 2:if(0===(a=e.sent).size){e.next=6;break}return console.log("noSeenSnapshot[0]"),e.abrupt("return",a.docs[0].id+"");case 6:return console.log("Math.random"),e.abrupt("return",Math.floor(5*Math.random())+"");case 8:case"end":return e.stop()}}),e)}))),this.pick_settler=function(){var e=Object(w.a)(f.a.mark((function e(a){var n,r,s,o,i,c,l,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),r=n-36e5,e.next=4,t.db.collection("Randomize").where("millis","<",r).orderBy("millis").get();case 4:if(0!==(s=e.sent).size){e.next=10;break}return console.log("oneHourNoSeenSnapshot == 0"),e.abrupt("return",t.pick_pioneer());case 10:console.log("oneHourNoSeenSnapshot:  ",s),o=Object(v.a)(s.docs);try{for(o.s();!(i=o.n()).done;)c=i.value,console.log("oneHourNoSeenSnapshot",c.id)}catch(d){o.e(d)}finally{o.f()}l=Object(v.a)(s.docs),e.prev=14,l.s();case 16:if((u=l.n()).done){e.next=23;break}if(c=u.value,a.has(c.id)){e.next=21;break}return console.log("!userHasSeen.has(clip.id)"),e.abrupt("return",c.id+"");case 21:e.next=16;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(14),l.e(e.t0);case 28:return e.prev=28,l.f(),e.finish(28);case 31:return e.abrupt("return",t.pick_pioneer());case 32:case"end":return e.stop()}}),e,null,[[14,25,28,31]])})));return function(t){return e.apply(this,arguments)}}(),this.findMin=(e,t)=>e>t?t:e,this.getNextClip=Object(w.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setState({currentTags:{},loading:!0,displayTag:{}});case 2:t.loadUrl();case 3:case"end":return e.stop()}}),e)}))),this.handleSubmit=Object(w.a)(f.a.mark((function e(){var a,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=document.getElementById("tags").value.toLowerCase().replace(/\s/g,"").split(","),n={},e.next=4,t.audioRef.collection("tags");case 4:return t.audioTagRef=e.sent,e.next=7,t.audioRef.collection("users");case 7:return t.audioUsersRef=e.sent,e.next=10,t.audioTagRef.get();case 10:return r=e.sent,e.next=13,t.loadExistingTag(r);case 13:t.existingTags=e.sent,console.log("existingTags"),console.log(t.existingTags),a.forEach(e=>{Object.keys(t.existingTags).includes(e)?n[e]={count:t.existingTags[e].count,score:0}:n[e]={count:0,score:0}}),console.log("displayTag"),console.log(t.state.displayTag),document.getElementById("tags").value="",t.loadTagsToDb(n).then(e=>{t.setState({currentTags:e});for(var a=0,n=Object.keys(e);a<n.length;a++){const r=n[a];t.setState(t=>({displayTag:Object(_.a)({},t.displayTag,{[r]:{score:e[r].score,count:e[r].count}})}))}});case 21:case"end":return e.stop()}}),e)}))),this.getUserId=function(){var e=Object(w.a)(f.a.mark((function e(a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.collection("audios").doc(t.clipId).collection("users").where("tags","array-contains",a).get();case 2:return n=e.sent,console.log("firstUser:  ",n.docs[0].id),e.abrupt("return",n.docs[0].id);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadTagsToDb=function(){var e=Object(w.a)(f.a.mark((function e(a){var n,r,s,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=0,r=Object.keys(a);case 2:if(!(n<r.length)){e.next=24;break}return s=r[n],e.next=6,t.addUser(s);case 6:if(t.History(t.userRef,t.currentId,0),1!==a[s].count){e.next=18;break}return e.next=10,t.getUserId(s);case 10:return o=e.sent,e.next=13,t.db.collection("users").doc(o);case 13:i=e.sent,console.log("!!firstUserId: "+o),o!==t.currentId&&(t.History(i,o,2),a[s].score=1,t.History(t.userRef,t.currentId,1)),e.next=19;break;case 18:a[s].count,t.History(t.userRef,t.currentId,0);case 19:return e.next=21,t.audioUsersRef.doc(t.currentId).set({tags:ce.a.firestore.FieldValue.arrayUnion(s)},{merge:!0});case 21:n++,e.next=2;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),console.log("can't upload tags into DB!!:  "+e.t0);case 29:return e.abrupt("return",a);case 30:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t){return e.apply(this,arguments)}}(),this.addUser=e=>{try{this.audioTagRef.doc(e).set({count:ce.a.firestore.FieldValue.increment(1),userId:ce.a.firestore.FieldValue.arrayUnion(this.currentId)},{merge:!0})}catch(t){console.log("can't add user: "+t)}},this.refreshTotalScore=(e,t)=>{e.update({score:ce.a.firestore.FieldValue.increment(t)})},this.isFrist=e=>{this.audioTagRef.doc(e).set({count:1,userId:ce.a.firestore.FieldValue.arrayUnion(this.currentId)})},this.History=function(){var e=Object(w.a)(f.a.mark((function e(a,n,r){var s,o,i,c,l,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.collection("clipHistory");case 3:(s=e.sent).doc(t.clipId).get().then(e=>{e.exists?t.updateHistory(s,r):t.createHistory(s,r),t.refreshTotalScore(a,r)}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("Can't create clipHistory!! "+e.t0);case 10:if(0===r){e.next=28;break}return o=t.oneDayRange(),e.prev=12,i=t.db.collection("scoreRecord").doc(n),e.next=16,t.db.collection("scoreRecord").doc(n).collection("score");case 16:return(c=e.sent).doc(o+"").get().then(e=>{e.exists?c.doc(o+"").update({score:ce.a.firestore.FieldValue.increment(r)}):c.doc(o+"").set({score:r,millis:o,createdAt:ce.a.firestore.FieldValue.serverTimestamp()})}),e.next=20,t.db.collection("users").doc(n).get();case 20:l=e.sent,u=l.data().username,i.set({updated:ce.a.firestore.FieldValue.serverTimestamp(),millis:o,username:u}),e.next=28;break;case 25:e.prev=25,e.t1=e.catch(12),console.log("Can't add score scoreRecord!");case 28:case"end":return e.stop()}}),e,null,[[0,7],[12,25]])})));return function(t,a,n){return e.apply(this,arguments)}}(),this.updateHistory=(e,t)=>{try{e.doc(this.clipId).update({score:ce.a.firestore.FieldValue.increment(t),lastUpdatedAt:ce.a.firestore.FieldValue.serverTimestamp()})}catch(a){console.log("Can't update clipHistory: "+a)}},this.createHistory=(e,t)=>{try{e.doc(this.clipId).set({score:ce.a.firestore.FieldValue.increment(t),createdAt:ce.a.firestore.FieldValue.serverTimestamp(),lastUpdatedAt:ce.a.firestore.FieldValue.serverTimestamp()})}catch(a){console.log("Can't create clipHistory: "+a)}},this.state=Object(_.a)({},de),this.textInput=r.a.createRef()}componentDidUpdate(e,t){this.textInput.current.focus()}render(){const e=this.url,t=this.clipId,a=this.state.displayTag;return r.a.createElement(y.q,{container:!0,className:"game-container",direction:"column",alignItems:"center",spacing:16},r.a.createElement(y.q,{item:!0,container:!0,alignItems:"center"},r.a.createElement(y.q,{item:!0,sm:1,md:1,lg:1},r.a.createElement(ue,null)),r.a.createElement(y.q,{item:!0,sm:10,md:10,lg:10},r.a.createElement("h1",null,"Describe this clip")),r.a.createElement(y.q,{item:!0,sm:1,md:1,lg:1})),r.a.createElement(y.q,{item:!0,container:!0,alignItems:"center"},r.a.createElement(y.q,{item:!0,sm:3,md:3,lg:3},r.a.createElement(y.t,{id:"gameSummary",style:{borderRadius:"0"},onClick:this.Summary},r.a.createElement(Z.a,null),"Summary")),this.state.loading?r.a.createElement(y.q,{item:!0,sm:6,md:6,lg:6,className:"canvas-container"},r.a.createElement(y.h,{size:100,thickness:3.6})):r.a.createElement(oe,{url:e,clipId:t}),r.a.createElement(y.q,{item:!0,sm:3,md:3,lg:3},r.a.createElement(y.t,{id:"nextClip",style:{borderRadius:"0"},onClick:this.getNextClip},"Next Clip",r.a.createElement(G.a,null)))),r.a.createElement(y.q,{item:!0,id:"listTag",sm:10,md:6,lg:8},Object.keys(a).map((e,t)=>0===a[e].count?r.a.createElement("span",{key:t,className:"gray"},e,"\xa0"):1===a[e].score?r.a.createElement("i",{key:t,className:"1-point"},e,"\xa0"):r.a.createElement("span",{key:t,className:"pink"},e,"\xa0"))),r.a.createElement(y.q,{item:!0,sm:10,md:6,lg:8},r.a.createElement(y.n,{margin:"normal",fullWidth:!0},r.a.createElement(y.w,null,"Input your tags..."),r.a.createElement(y.u,{id:"tags",type:"text",autoFocus:!0,inputRef:this.textInput,onKeyPress:this.handleKeyPress,endAdornment:r.a.createElement(y.v,{position:"end"},r.a.createElement(y.t,{id:"submitButton",onClick:this.handleSubmit},r.a.createElement(V.a,null)),r.a.createElement(y.K,{title:r.a.createElement("p",null,"You can input more than one tag ",r.a.createElement("br",null),"by using commas to separate."),placement:"right"},r.a.createElement(y.s,null,r.a.createElement(Q.a,null))))}),r.a.createElement(y.p,null,"Tag colors: ",r.a.createElement("i",null,"1 point"),", ",r.a.createElement("span",{className:"gray"},"no points yet (but could be 2)"),", ",r.a.createElement("span",{className:"pink"},"0 points"),"."))))}}var he=a(204),pe=a.n(he),ge=a(203),ye=a.n(ge);class Ee extends n.Component{constructor(e){super(e),this.setupAudioContext=()=>{try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=15,this.gainNode.connect(this.audioContext.destination)}catch(e){console.log(e)}this.audio=new Audio(this.props.url),this.audioSource=this.audioContext.createMediaElementSource(this.audio),this.audio.crossOrigin="anonymous",this.audioSource.connect(this.gainNode),this.audioContext.resume().then(()=>{console.log("Playback resumed successfully")}),this.audio.onended=()=>{this.setState({play:!1}),this.props.togglePlay(!1)}},this.toggleAudio=()=>{if(!1===this.state.play)try{this.setupAudioContext()}catch(e){console.log(e)}this.state.play?this.audio.pause():this.audio.play(),this.setState({play:!this.state.play}),this.props.togglePlay(!this.state.play)},this.toggleSeeOtherTags=()=>{this.setState({seeOthers:!this.state.seeOthers})},this.SummaryAudioCard=()=>r.a.createElement(y.d,{className:"audio-card"},r.a.createElement(y.f,null,r.a.createElement("h5",null,this.props.clip),r.a.createElement("p",null,"Your tags: ",this.props.TAG||"loading"),this.state.seeOthers?r.a.createElement("p",null,"Other's tags: ",this.props.other||"None"," "):""),r.a.createElement(y.e,{style:{paddingTop:"0"}},r.a.createElement(y.t,{onClick:this.toggleAudio},this.state.play?r.a.createElement(ae.a,null):r.a.createElement(ee.a,null)),r.a.createElement(y.t,{onClick:this.toggleSeeOtherTags},this.state.seeOthers?r.a.createElement(ye.a,null):r.a.createElement(pe.a,null)))),this.SearchResultAudioCard=()=>r.a.createElement(y.d,{className:"audio-card"},r.a.createElement(y.f,null,r.a.createElement("h5",null,this.props.clip)),r.a.createElement(y.e,{style:{paddingTop:"0"}},r.a.createElement(y.t,{onClick:this.toggleAudio},this.state.play?r.a.createElement(ae.a,null):r.a.createElement(ee.a,null))),r.a.createElement("h5",null,this.props.tag,": ",this.props.count," times")),this.state={play:!1,seeOthers:!1}}componentDidMount(){this.setupAudioContext()}componentWillUnmount(){this.gainNode.disconnect(),this.audioSource.disconnect()}render(){return r.a.createElement("div",null,this.props.fromSummary?this.SummaryAudioCard():this.SearchResultAudioCard())}}var fe=Ee;class be extends n.Component{constructor(e){super(e),this.togglePlay=e=>{this.setState({play:e})},this.state={clipHistory:{},scoredClipHistory:{},play:!1}}componentDidMount(){var e=this;return Object(w.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.user=p.auth().currentUser,e.db=p.firestore(),e.audioRef=e.db.collection("audios"),e.userId=e.user.uid,e.userRef=e.db.collection("users").doc(e.userId);case 5:case"end":return t.stop()}}),t)})))()}render(){const e=this.props.location.state,t=e.clipHistory,a=e.scoredClipHistory;return r.a.createElement(y.q,{container:!0,className:"summary-container",direction:"column",alignItems:"center"},r.a.createElement(y.q,{item:!0},r.a.createElement("h1",null,"Summary Page")),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/main/clip"},"Play game!")),r.a.createElement("h2",null,"Your last 10 clips"),r.a.createElement(y.q,{item:!0,className:"card-list-container"},r.a.createElement(y.q,{container:!0,className:"card-list",spacing:8},Object.keys(t).map((e,a)=>r.a.createElement(y.q,{item:!0,key:e},r.a.createElement(fe,{url:t[e].url,clip:t[e].title,clipId:t[e].id,TAG:t[e].TAG,togglePlay:this.togglePlay,other:t[e].other,fromSummary:!0}))))),r.a.createElement("h2",null,"Your last scored clips"),r.a.createElement(y.q,{item:!0,className:"card-list-container"},r.a.createElement(y.q,{container:!0,className:"card-list",spacing:8},Object.keys(a).map((e,t)=>r.a.createElement(y.q,{item:!0,key:t},r.a.createElement(fe,{url:a[e].url,clip:a[e].title,TAG:a[e].TAG,clipId:a[e].id,other:a[e].other,togglePlay:this.togglePlay,fromSummary:!0}))))))}}var ve=be;class we extends n.Component{constructor(e){var t;super(e),t=this,this.month=()=>{var e=[];return e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December",e},this.handleChange=(e,t)=>{this.setState({value:t})},this.oneDayRange=()=>{var e=this.month(),t=new Date,a=t.getDate()+"";const n=e[t.getMonth()]+" "+a+", "+(t.getFullYear()+"");var r=Date.parse(n);return console.log("today: ",r),r+864e5},this.firstOfWeekRange=()=>{var e=this.month(),t=new Date,a=t.getDay(),n=t.getDate()+"";const r=e[t.getMonth()]+" "+n+", "+(t.getFullYear()+"");var s=Date.parse(r);return console.log("first day of the week",a),s-36e5*(a-1)*24},this.getTotal=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,t.db.collection("users").where("score",">",0).get();case 3:n=e.sent,r=Object(v.a)(n.docs);try{for(r.s();!(s=r.n()).done;)o=s.value,i={username:o.data().username,score:o.data().score,userId:o.id},a.push(i)}catch(c){r.e(c)}finally{r.f()}return a.sort((e,t)=>t.score-e.score),a.splice(10,a.length),e.next=10,t.setState({totalLeader:a});case 10:console.log(t.state.totalLeader);case 11:case"end":return e.stop()}}),e)}))),this.getToday=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i,c,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],n=t.oneDayRange(),e.next=4,t.db.collection("scoreRecord").where("millis","==",n).get();case 4:r=e.sent,s=Object(v.a)(r.docs),e.prev=6,s.s();case 8:if((o=s.n()).done){e.next=17;break}return i=o.value,e.next=12,t.db.collection("scoreRecord").doc(i.id).collection("score").where("millis","==",n).get();case 12:c=e.sent,l={username:i.data().username,score:c.docs[0].data().score,userId:i.id},a.push(l);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),s.e(e.t0);case 22:return e.prev=22,s.f(),e.finish(22);case 25:return a.sort((e,t)=>t.score-e.score),a.splice(10,a.length),e.next=29,t.setState({todayLeader:a});case 29:console.log("today: ",new Date(n)),console.log("today!!!leader: ",a);case 31:case"end":return e.stop()}}),e,null,[[6,19,22,25]])}))),this.getWeek=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o,i,c,l,u,d,m,h;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],n=t.firstOfWeekRange(),console.log("thisWeekRange:  ",n),console.log("Sunday",new Date(n)),e.next=6,t.db.collection("scoreRecord").where("millis",">=",n).get();case 6:r=e.sent,s=Object(v.a)(r.docs),e.prev=8,s.s();case 10:if((o=s.n()).done){e.next=22;break}return i=o.value,c=0,e.next=15,t.db.collection("scoreRecord").doc(i.id).collection("score").where("millis",">=",n).get();case 15:l=e.sent,u=Object(v.a)(l.docs);try{for(u.s();!(d=u.n()).done;)m=d.value,c+=m.data().score}catch(p){u.e(p)}finally{u.f()}h={username:i.data().username,score:c,userId:i.id},a.push(h);case 20:e.next=10;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(8),s.e(e.t0);case 27:return e.prev=27,s.f(),e.finish(27);case 30:return a.sort((e,t)=>t.score-e.score),a.splice(10,a.length),e.next=34,t.setState({weekLeader:a});case 34:console.log("weekLeader: ",a);case 35:case"end":return e.stop()}}),e,null,[[8,24,27,30]])}))),this.getTabContent=(e,t,a)=>{let n;switch(this.state.value){case 0:n=e;break;case 1:n=t;break;case 2:n=a;break;default:n=[]}return r.a.createElement(y.D,{className:"leaderboard"},r.a.createElement(y.G,null,r.a.createElement(y.H,null,r.a.createElement(y.F,{align:"center"},"User"),r.a.createElement(y.F,{align:"center"},"Score"))),r.a.createElement(y.E,null,n.map((e,t)=>r.a.createElement(y.H,{key:e.userId},r.a.createElement(y.F,{align:"center"},e.username),r.a.createElement(y.F,{align:"center"},e.score)))))},this.state={value:0,todayLeader:[],weekLeader:[],totalLeader:[]}}componentDidMount(){this.user=p.auth().currentUser,this.db=p.firestore(),this.user&&(this.currentId=p.auth().currentUser.uid),this.getTotal(),this.getToday(),this.getWeek()}render(){const e=this.state,t=e.todayLeader,a=e.weekLeader,n=e.totalLeader;return r.a.createElement("div",null,r.a.createElement("h1",null,"Leaders"),r.a.createElement("div",{className:"table-container"},r.a.createElement(y.a,{position:"static"},r.a.createElement(y.I,{value:this.state.value,onChange:this.handleChange,centered:!0},r.a.createElement(y.C,{label:"Today"}),r.a.createElement(y.C,{label:"This week"}),r.a.createElement(y.C,{label:"Total"}))),this.getTabContent(t,a,n)))}}var xe=we,ke=a(58),Ce=a.n(ke),Se=a(57),Ie=a.n(Se),Te=a(78),je=a.n(Te);class Oe extends n.Component{constructor(e){var t;super(e),t=this,this.getTagList=Object(w.a)(f.a.mark((function e(){var a,n,r,s,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,t.db.collection("tagList").orderBy("count","desc").limit(10).get();case 3:n=e.sent,r=Object(v.a)(n.docs);try{for(r.s();!(s=r.n()).done;)o=s.value,a.push({tag:o.id,count:o.data().count})}catch(i){r.e(i)}finally{r.f()}return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),this.handleKeyPress=e=>{"Enter"===e.key&&document.getElementById("searchButton").click()},this.handleSubmit=()=>{var e=document.getElementById("searchItem").value;this.handleListClick(null,e)},this.handleListClick=function(){var e=Object(w.a)(f.a.mark((function e(a,n){var r,s,o,i,c,l,u,d,m;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.collection("tagList").doc(n).collection("clipIDs").get();case 2:return r=e.sent,e.next=5,t.db.collection("tagList").doc(n).collection("clipIDs").orderBy("count","desc").get();case 5:s=e.sent,o=[],i=Object(v.a)(s.docs);try{for(i.s();!(c=i.n()).done;)l=c.value,o.push({tag:l.id,count:l.data().count})}catch(a){i.e(a)}finally{i.f()}t.MyTagMap={},u=Object(v.a)(r.docs),e.prev=11,u.s();case 13:if((d=u.n()).done){e.next=24;break}return l=d.value,t.MyTagMap[l.id]={},e.next=18,t.db.collection("tagList").doc(n).collection("clipIDs").doc(l.id).get();case 18:m=e.sent,t.MyTagMap[l.id].url=m.data().Url,t.MyTagMap[l.id].clip=m.data().Title,t.MyTagMap[l.id].count=m.data().count;case 22:e.next=13;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(11),u.e(e.t0);case 29:return e.prev=29,u.f(),e.finish(29);case 32:t.props.history.push({pathname:"/searchresult",state:{tag:n,MyTag:t.MyTagMap,tagOrderArray:o,clipNumber:r.size}});case 33:case"end":return e.stop()}}),e,null,[[11,26,29,32]])})));return function(t,a){return e.apply(this,arguments)}}(),this.getList=e=>r.a.createElement(Ce.a,null,e.map((e,t)=>r.a.createElement(Ie.a,{button:!0,key:e.tag},r.a.createElement(je.a,{primary:e.tag,onClick:t=>this.handleListClick(t,e.tag)})))),this.state={topTags:[]}}componentDidMount(){var e=this;return Object(w.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.user=p.auth().currentUser,e.db=p.firestore(),e.currentId=p.auth().currentUser.uid,e.userRef=e.db.collection("users"),t.t0=e,t.next=7,e.getTagList();case 7:t.t1=t.sent,t.t2={topTags:t.t1},t.t0.setState.call(t.t0,t.t2);case 10:case"end":return t.stop()}}),t)})))()}render(){const e=this.state.topTags;return r.a.createElement(y.q,{container:!0,className:"search-container",direction:"column",alignItems:"center"},r.a.createElement(y.q,{item:!0},r.a.createElement("h1",null,"Search Page")),r.a.createElement(y.q,{item:!0},r.a.createElement("label",null,"Search by tag: "),r.a.createElement("input",{id:"searchItem",type:"text",onKeyPress:this.handleKeyPress}),r.a.createElement(y.b,{id:"searchButton",onClick:this.handleSubmit},"search")),r.a.createElement(y.q,{item:!0,xs:12,md:6},r.a.createElement("div",null,this.getList(e))))}}var qe=Oe;class Ae extends n.Component{constructor(e){super(e),this.togglePlay=e=>{this.setState({play:e})},this.state={play:!1}}componentDidMount(){var e=this;return Object(w.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.user=p.auth().currentUser,e.db=p.firestore(),e.audioRef=e.db.collection("audios"),e.userId=e.user.uid,e.userRef=e.db.collection("users").doc(e.userId);case 5:case"end":return t.stop()}}),t)})))()}render(){const e=this.props.location.state,t=e.MyTag,a=e.tag,n=e.clipNumber,s=e.tagOrderArray;return r.a.createElement(y.q,{container:!0,className:"summary-container",direction:"column",alignItems:"center"},r.a.createElement(y.q,{item:!0},r.a.createElement("h1",null,"Search Result")),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/search"},"Search more!")),r.a.createElement(y.q,{item:!0},r.a.createElement(x.a,{to:"/main/clip"},"Play game!")),r.a.createElement("h2",null,"Here are ",n," clips have been describe as ",a),r.a.createElement(y.q,{item:!0,className:"card-list-container"},r.a.createElement(y.q,{container:!0,className:"card-list",spacing:8},s.map((e,n)=>r.a.createElement(y.q,{item:!0,key:e.tag},r.a.createElement(fe,{tag:a,clip:t[e.tag].clip,url:t[e.tag].url,count:t[e.tag].count,togglePlay:this.togglePlay,fromSummary:!1}))))))}}var Pe=Ae;const Ne=Object(g.createMuiTheme)({palette:{primary:{main:"#C6C6CE"},secondary:{main:"#A6A6B2"}},typography:{useNextVariants:!0}});function Re(e){let t=e.component,a=e.authenticated,n=Object(i.a)(e,["component","authenticated"]);return r.a.createElement(c.a,Object.assign({},n,{render:e=>!0===a?r.a.createElement(t,Object.assign({},e,n)):r.a.createElement(l.a,{to:"/"})}))}class De extends n.Component{constructor(e){super(e),this.toggleAuth=e=>{this.setState({authenticated:e})},this.state={authenticated:!1,user:null,loading:!0}}componentDidMount(){this.listener=p.auth().onAuthStateChanged(e=>{e?this.setState({authenticated:!0,user:e,loading:!1}):this.setState({authenticated:!1,user:null,loading:!1})})}componentWillUnmount(){this.listener()}render(){return this.state.loading?r.a.createElement(g.MuiThemeProvider,{theme:Ne},r.a.createElement("div",{className:"loading-container"},r.a.createElement(y.h,{size:100,thickness:3.6}))):r.a.createElement(g.MuiThemeProvider,{theme:Ne},r.a.createElement(u.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(W,{authenticated:this.state.authenticated,toggleAuth:this.toggleAuth}),r.a.createElement("main",null,r.a.createElement(d.a,null,r.a.createElement(c.a,{exact:!0,path:"/",render:e=>r.a.createElement(A,Object.assign({},e,{authenticated:this.state.authenticated}))}),r.a.createElement(c.a,{path:"/info/faq",component:D}),r.a.createElement(c.a,{path:"/info/contact",component:H}),r.a.createElement(c.a,{path:"/info/privacy",component:T}),r.a.createElement(c.a,{path:"/info/leaders",component:xe}),r.a.createElement(c.a,{path:"/searchresult",component:Pe}),r.a.createElement(Re,{exact:!0,path:"/main",component:ve,authenticated:this.state.authenticated}),r.a.createElement(Re,{exact:!0,path:"/main/clip",component:me,authenticated:this.state.authenticated}),r.a.createElement(Re,{path:"/search",component:qe,authenticated:this.state.authenticated}))),r.a.createElement(N,null))))}}var Me=De;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Me,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[263,1,2]]]);
//# sourceMappingURL=main.0751a0ca.chunk.js.map